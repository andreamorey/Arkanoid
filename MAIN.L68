00001F5E Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 06/01/2020 2:00:46

00000000                             1  ; =============================================================================
00000000                             2  ; TITLE    : BREAKING BLOCKS
00000000                             3  ; AUTHOR   : ANDREA MOREY SANCHEZ Y AISHA GANDAROVA
00000000                             4  ; CREATION : 
00000000                             5  ; =============================================================================
00000000                             6  
00001000                             7              ORG     $1000
00001000                             8              
00001000                             9  ; --- CODE INCLUDES -----------------------------------------------------------
00001000                            10            
00001000                            11              INCLUDE "SYSCONST.X68"          ; SYSTEM CONSTANTS
00001000                            12  ; =============================================================================
00001000                            13  ; SYSTEM CONSTANTS
00001000                            14  ; =============================================================================
00001000                            15  
00001000                            16  ; --- TRAP RELATED CONSTANTS --------------------------------------------------
00001000                            17  
00001000  =00000000                 18  KBDTRAP     EQU     0                       ; KEYBOARD UPDATE TRAP
00001000  =00000001                 19  SCRTRAP     EQU     1                       ; SCREEN REFRESH TRAP
00001000                            20  
00001000                            21  ; --- KEY CODES (EASy68K)
00001000                            22  
00001000  =00000020                 23  KBDCHRSP    EQU     $20                     ; SPACE KEY
00001000  =0000004D                 24  KBDCHRMK    EQU     'M'                     ; M KEY
00001000  =00000010                 25  KBDCHRSH    EQU     $10                     ; SHIFT KEY
00001000  =00000050                 26  KBDCHRPK    EQU     'P'                     ; P KEY
00001000  =00000025                 27  KBDCHRLF    EQU     $25                     ; LEFT KEY
00001000  =00000026                 28  KBDCHRUP    EQU     $26                     ; UP KEY
00001000  =00000027                 29  KBDCHRRT    EQU     $27                     ; RIGHT KEY
00001000  =00000028                 30  KBDCHRDN    EQU     $28                     ; DOWN KEY
00001000                            31  
00001000                            32  ; --- KEYBOARD MAPPING --------------------------------------------------------
00001000                            33  
00001000  =00000025                 34  KBDLEFT     EQU     KBDCHRLF                ; LEFT BUTTON
00001000  =00000026                 35  KBDUP       EQU     KBDCHRUP                ; UP BUTTON
00001000  =00000027                 36  KBDRIGHT    EQU     KBDCHRRT                ; RIGHT BUTTON
00001000  =00000028                 37  KBDDOWN     EQU     KBDCHRDN                ; DOWN BUTTON
00001000  =00000020                 38  KBDFIRE1    EQU     KBDCHRSP                ; FIRE 1 BUTTON
00001000  =0000004D                 39  KBDFIRE2    EQU     KBDCHRMK                ; FIRE 2 BUTTON
00001000  =00000010                 40  KBDFIRE3    EQU     KBDCHRSH                ; FIRE 3 BUTTON
00001000  =00000050                 41  KBDPAUSE    EQU     KBDCHRPK                ; PAUSE BUTTON
00001000                            42  
00001000                            43  ; --- KEYBOARD BITFIELD MASKS -------------------------------------------------
00001000                            44  ; CONVENIENCE CONSTANTS TO ACCESS THE FOLLOWING BIT-FIELD.
00001000                            45  ; THIS BIT-FIELD IS USED BY SYSTEM VARS (KBDVAL) AND (KBDEDGE).
00001000                            46  ; +---+---+---+---+---+---+---+---+
00001000                            47  ; | 7 | 6 | 5 | 4 | 3 | 2 | 1 | 0 |
00001000                            48  ; +---+---+---+---+---+---+---+---+
00001000                            49  ;   |   |   |   |   |   |   |   |
00001000                            50  ;   |   |   |   |   |   |   |   +---------- LEFT BUTTON
00001000                            51  ;   |   |   |   |   |   |   +-------------- UP BUTTON
00001000                            52  ;   |   |   |   |   |   +------------------ RIGHT BUTTON
00001000                            53  ;   |   |   |   |   +---------------------- DOWN BUTTON
00001000                            54  ;   |   |   |   +-------------------------- FIRE 1 BUTTON
00001000                            55  ;   |   |   +------------------------------ FIRE 2 BUTTON
00001000                            56  ;   |   +---------------------------------- FIRE 3 BUTTON
00001000                            57  ;   +-------------------------------------- PAUSE BUTTON
00001000                            58  
00001000  =00000001                 59  KBDMSKLF    EQU     %00000001
00001000  =00000002                 60  KBDMSKUP    EQU     %00000010
00001000  =00000004                 61  KBDMSKRT    EQU     %00000100
00001000  =00000008                 62  KBDMSKDN    EQU     %00001000
00001000  =00000010                 63  KBDMSKF1    EQU     %00010000
00001000  =00000020                 64  KBDMSKF2    EQU     %00100000
00001000  =00000040                 65  KBDMSKF3    EQU     %01000000
00001000  =00000080                 66  KBDMSKPS    EQU     %10000000
00001000                            67  
00001000                            68  ; --- KEYBOARD BITFIELD POSITIONS ---------------------------------------------
00001000                            69  
00001000  =00000000                 70  KBDBITLF    EQU     0
00001000  =00000001                 71  KBDBITUP    EQU     1
00001000  =00000002                 72  KBDBITRT    EQU     2
00001000  =00000003                 73  KBDBITDN    EQU     3
00001000  =00000004                 74  KBDBITF1    EQU     4
00001000  =00000005                 75  KBDBITF2    EQU     5
00001000  =00000006                 76  KBDBITF3    EQU     6
00001000  =00000007                 77  KBDBITPS    EQU     7
00001000                            78  
00001000                            79  ; --- SCREEN RELATED CONSTANTS ------------------------------------------------
00001000                            80  
00001000  =000002E4                 81  SCRWIDTH    EQU     740                     ; SCREEN WIDTH (PIXELS)
00001000  =000001E0                 82  SCRHEIGH    EQU     480                     ; SCREEN HEIGHT (PIXELS)
00001000  =00000001                 83  SCRIRQ      EQU     1                       ; SCREEN INTERRUPT NUMBER
00001000  =00000014                 84  SCRTIM      EQU     20                      ; SCREEN TIMER (MS)
00001000                            85  
00001000                            86  ; --- DYNAMIC MEMORY CONSTANTS ------------------------------------------------
00001000                            87  
00001000  =00000040                 88  DMMBSIZE    EQU     64                      ; BLOCK SIZE (BYTES). POWER OF TWO
00001000  =00000032                 89  DMMBNUM     EQU     50                      ; NUMBER OF BLOCKS
00001000  =00000000                 90  DMMSYSID    EQU     0                       ; SYSTEM OWNER ID (MUST BE 0)
00001000                            91  
00001000                            92  
00001000                            93  -------------------- end include --------------------
00001000                            94              INCLUDE "SYSTEM.X68"            ; SYSTEM CODE
00001000                            95  ; =============================================================================
00001000                            96  ; SYSTEM MANAGEMENT (SYSTEM CODE)
00001000                            97  ; =============================================================================
00001000                            98  ;           AUTHORS: Andrea Morey Sánchez and Aisha Gandarova
00001000                            99  ; -----------------------------------------------------------------------------
00001000                           100  SYSINIT
00001000                           101  ; INITIALIZES THE SYSTEM
00001000                           102  ; INPUT    - NONE
00001000                           103  ; OUTPUT   - NONE
00001000                           104  ; MODIFIES - NONE
00001000                           105  ; -----------------------------------------------------------------------------
00001000  205F                     106              MOVE.L  (A7)+,A0                ; GET RETURN ADDRESS
00001002  4EB9 000010A6            107              JSR     KBDINIT                 ; INIT KEYBOARD
00001008  4EB9 0000101C            108              JSR     SCRINIT                 ; INIT SCREEN
0000100E  4EB9 0000111A            109              JSR     DMMINIT                 ; INIT DYNAMIC MEMORY
00001014  027C DFFF                110              ANDI.W  #$DFFF,SR               ; SWITCH TO USER
00001018  2F08                     111              MOVE.L  A0,-(A7)                ; PUT RETURN ADDRESS
0000101A  4E75                     112              RTS
0000101C                           113  
0000101C                           114  ; =============================================================================
0000101C                           115  ; SCREEN MANAGEMENT (SYSTEM CODE)
0000101C                           116  ; =============================================================================
0000101C                           117  
0000101C                           118  ; -----------------------------------------------------------------------------
0000101C                           119  SCRINIT
0000101C                           120  ; INITIALIZES THE SCREEN, SCREEN-RELATED INTERRUPT AND VARS.
0000101C                           121  ; INPUT    - NONE
0000101C                           122  ; OUTPUT   - NONE
0000101C                           123  ; MODIFIES - D0,D1,D2,D3
0000101C                           124  ; -----------------------------------------------------------------------------
0000101C                           125              ; TO DO:
0000101C                           126              ; - DISABLE INTS (SET INT BITS IN SR TO 111)
0000101C  007C 0700                127              ORI.W   #$0700,SR
00001020                           128              ; - DISABLE ALL AUTO-IRQ (SEE TRAP #15 TASK 32)
00001020                           129              ; - INSTALL SCRUPD INTO TRAP SCRTRAP
00001020  21FC 0000108C 0084       130              MOVE.L  #SCRUPD,$80+(SCRTRAP*4)
00001028                           131              ; - SET RESOLUTION TO SCRWIDTH X SCRHEIGHT
00001028  103C 0021                132              MOVE.B  #33,D0
0000102C  223C 02E401E0            133              MOVE.L  #(SCRWIDTH<<16)|SCRHEIGH,D1
00001032  4E4F                     134              TRAP    #15
00001034                           135              ; - SET WINDOWED MODE
00001034  7201                     136              MOVE.L  #1,D1
00001036  4E4F                     137              TRAP    #15
00001038                           138              ; - CLEAR VISIBLE BUFFER
00001038  103C 000B                139              MOVE.B  #11,D0
0000103C  323C FF00                140              MOVE.W  #$FF00,D1
00001040  4E4F                     141              TRAP    #15
00001042                           142              ; - ENABLE DOUBLE BUFFER
00001042  103C 005C                143              MOVE.B  #92,D0
00001046  123C 0011                144              MOVE.B  #17,D1
0000104A  4E4F                     145              TRAP    #15
0000104C                           146              ; - CLEAR HIDDEN BUFFER
0000104C  700B                     147              MOVE.L  #11,D0
0000104E  323C FF00                148              MOVE.W  #$FF00,D1
00001052  4E4F                     149              TRAP    #15
00001054                           150              ; - INSTALL SCRISR FOR IRQ SCRIRQ (IRQ INTERRUPT VECTOR BEGINS
00001054                           151              ;   AT $60. INSTALLATION IS SIMILAR TO TRAP INSTALLATION)
00001054  21FC 0000107E 0064       152              MOVE.L  #SCRISR,$60+(SCRIRQ*4)
0000105C                           153              ; - ENABLE AUTO-IRQ EVERY SCRTIM MS FOR IRQ SCRIRQ (SEE TRAP #15
0000105C                           154              ;   TASK 32)
0000105C  103C 0020                155              MOVE.B  #32,D0
00001060  123C 0006                156              MOVE.B  #6,D1
00001064                           157         
00001064  143C 0081                158              MOVE.B  #$80|SCRIRQ,D2
00001068  7614                     159              MOVE.L  #SCRTIM,D3
0000106A  4E4F                     160              TRAP    #15
0000106C                           161              ; - CLEAR SCRINTCT AND SCRCYCCT
0000106C  4239 00001F88            162              CLR.B   SCRINTCT
00001072  4239 00001F89            163              CLR.B   SCRCYCCT
00001078                           164              ; - ENABLE INTS (SET INT BITS IN SR TO 000)
00001078  027C F8FF                165              ANDI.W  #$F8FF,SR
0000107C  4E75                     166              RTS
0000107E                           167  
0000107E                           168  ; -----------------------------------------------------------------------------
0000107E                           169  SCRISR
0000107E                           170  ; SCREEN TIMER ISR. INCREASES THE INTERRUPT COUNTER AND UPDATES DOUBLE BUFFER.
0000107E                           171  ; INPUT    - NONE
0000107E                           172  ; OUTPUT   - NONE
0000107E                           173  ; MODIFIES - NONE
0000107E                           174  ; -----------------------------------------------------------------------------
0000107E  5239 00001F88            175              ADDQ.B  #1,(SCRINTCT)           ; UPDATE INT FLAG/COUNTER
00001084  5239 00001F89            176              ADDQ.B  #1,(SCRCYCCT)           ; UPDATE CYCLE COUNTER
0000108A  4E73                     177              RTE
0000108C                           178  
0000108C                           179  ; -----------------------------------------------------------------------------
0000108C                           180  SCRUPD
0000108C                           181  ; TRAP SERVICE ROUTINE IN CHARGE OF VISUALIZING CURRENT FRAME AND CLEARING
0000108C                           182  ; BUFFER FOR THE NEXT ONE.
0000108C                           183  ; INPUT    - NONE
0000108C                           184  ; OUTPUT   - NONE
0000108C                           185  ; MODIFIES - NONE
0000108C                           186  ; -----------------------------------------------------------------------------
0000108C                           187              ; TO DO: UPDATE DOUBLE BUFFER AND CLEAR HIDDEN BUFFER
0000108C  48E7 C000                188              MOVEM.L D0-D1,-(A7)
00001090  103C 005E                189              MOVE.B  #94,D0
00001094  4E4F                     190              TRAP    #15
00001096  103C 000B                191              MOVE.B  #11,D0
0000109A  323C FF00                192              MOVE.W  #$FF00,D1
0000109E  4E4F                     193              TRAP    #15
000010A0  4CDF 0003                194              MOVEM.L (A7)+,D0-D1
000010A4  4E73                     195              RTE
000010A6                           196  
000010A6                           197  ; =============================================================================
000010A6                           198  ; KEYBOARD MANAGEMENT (SYSTEM CODE)
000010A6                           199  ; =============================================================================
000010A6                           200  
000010A6                           201  ; -----------------------------------------------------------------------------
000010A6                           202  KBDINIT
000010A6                           203  ; INITIALIZES THE SYSTEM VARIABLES KBDSYS AND KBDVAL
000010A6                           204  ; INPUT    - NONE
000010A6                           205  ; OUTPUT   - NONE
000010A6                           206  ; MODIFIES - NONE
000010A6                           207  ; -----------------------------------------------------------------------------
000010A6  4239 00001F86            208              CLR.B   (KBDVAL)                ; INIT VARS
000010AC  4239 00001F87            209              CLR.B   (KBDEDGE)
000010B2  21FC 000010BC 0080       210              MOVE.L  #KBDREAD,($80+KBDTRAP*4) ; INSTALL
000010BA  4E75                     211              RTS
000010BC                           212  
000010BC                           213  ; -----------------------------------------------------------------------------
000010BC                           214  KBDREAD
000010BC                           215  ; TRAP SERVICE ROUTINE.
000010BC                           216  ; UPDATES THE SYSTEM VARIABLES KBDEDGE AND KBDVAL ACCORDING TO THE BITFIELD
000010BC                           217  ; DESCRIBED IN SYSCONST. KBDVAL HOLDS THE CURRENT VALUES AND KBDEFGE HOLDS
000010BC                           218  ; RISING EDGES FROM PREVIOUS CALL TO THE CURRENT ONE.
000010BC                           219  ; INPUT    - NONE
000010BC                           220  ; OUTPUT   - (KBDVAL) AND (KBDEDGE)
000010BC                           221  ; MODIFIES - NONE
000010BC                           222  ; -----------------------------------------------------------------------------
000010BC                           223              ; TO DO: UPDATE KBDVAL AND KBDEDGE
000010BC  48E7 F800                224              MOVEM.L D0-D4,-(A7)
000010C0  103C 0013                225              MOVE.B  #19,D0
000010C4                           226              
000010C4  223C 50104D20            227              MOVE.L  #KBDPAUSE<<24+KBDFIRE3<<16+KBDFIRE2<<8+KBDFIRE1,D1
000010CA  4E4F                     228              TRAP    #15
000010CC                           229          
000010CC  4202                     230              CLR.B   D2                      ; D2 WILL CONTAIN THE VALUE OF KBDVAL
000010CE  383C 0003                231              MOVE.W  #3,D4
000010D2                           232              
000010D2                           233  .LOOP1      
000010D2                           234       
000010D2  E189                     235              LSL.L   #8,D1                   ; FLAG C = THE VALUE OF THE KBD
000010D4  40C3                     236              MOVE.W  SR,D3                   
000010D6  0243 0001                237              ANDI.W  #$0001,D3               ; D3 = VALUE OF THE FLAG C
000010DA  E30A                     238              LSL.B   #1,D2                   ; MOVE THE BITS TO THE LEFT
000010DC  8403                     239              OR.B    D3,D2                   
000010DE  51CC FFF2                240              DBRA    D4,.LOOP1
000010E2                           241          
000010E2                           242              ;D2 = 0 0 0 0 KBDPAUSE KBDFIRE3 KBDFIRE2 KBDFIRE1
000010E2                           243              
000010E2  223C 28272625            244              MOVE.L  #KBDDOWN<<24+KBDRIGHT<<16+KBDUP<<8+KBDLEFT,D1
000010E8  4E4F                     245              TRAP    #15
000010EA                           246              
000010EA  383C 0003                247              MOVE.W  #3,D4
000010EE                           248  .LOOP2      
000010EE  E189                     249              LSL.L   #8,D1                   ; FLAG C = THE VALUE OF THE KBD
000010F0  40C3                     250              MOVE.W  SR,D3
000010F2  0243 0001                251              ANDI.W  #$0001,D3    
000010F6  E30A                     252              LSL.B   #1,D2
000010F8  8403                     253              OR.B    D3,D2
000010FA                           254              
000010FA  51CC FFF2                255              DBRA    D4,.LOOP2
000010FE                           256              
000010FE                           257              ; D2 = KBDPAUSE KBDFIRE3 KBDFIRE2 KBDFIRE1 KBDDOWN KBDRIGHT KBDUP KBDLEFT
000010FE                           258              
000010FE                           259              ; UPDATE KBDVAL AND KBDEDGE
000010FE  1639 00001F86            260              MOVE.B  KBDVAL,D3
00001104  4603                     261              NOT.B   D3
00001106  13C2 00001F86            262              MOVE.B  D2,KBDVAL
0000110C  C602                     263              AND.B   D2,D3
0000110E  13C3 00001F87            264              MOVE.B  D3,KBDEDGE
00001114  4CDF 001F                265              MOVEM.L (A7)+,D0-D4
00001118  4E73                     266              RTE
0000111A                           267  
0000111A                           268  ; =============================================================================
0000111A                           269  ; DYNAMIC MEMORY MANAGEMENT (SYSTEM CODE)
0000111A                           270  ; DYNAMIC MEMORY IS A SET OF DMMBNUM SLOTS OF DMMBSIZE BYTES EACH ONE.
0000111A                           271  ; DMMBSIZE MUST BE POWER OF TWO. A SLOT HAS:
0000111A                           272  ; - HEADER - 1 WORD. SPECIFIES THE OWNER (0 MEANS OWNED BY SYSTEM)
0000111A                           273  ; - DATA   - DMMBSIZE - 2 BYTES. MAY CONTAIN VARS AND ANY KIND OF DATA RELATED
0000111A                           274  ;            THE THE OWNER. IF OWNER==0, DATA IS MEANINGLESS.
0000111A                           275  ; =============================================================================
0000111A                           276  
0000111A                           277  ; -----------------------------------------------------------------------------
0000111A                           278  DMMINIT
0000111A                           279  ; INITIALIZES THE DYNAMIC MEMORY TO ALL OWNED BY SYSTEM.
0000111A                           280  ; INPUT    - NONE
0000111A                           281  ; OUTPUT   - NONE
0000111A                           282  ; MODIFIES - NONE
0000111A                           283  ; -----------------------------------------------------------------------------
0000111A  48E7 8080                284              MOVEM.L D0/A0,-(A7)
0000111E  41F9 00001FC0            285              LEA     DMMDATA,A0
00001124  303C 0031                286              MOVE.W  #DMMBNUM-1,D0
00001128  30BC 0000                287  .LOOP       MOVE.W  #DMMSYSID,(A0)
0000112C  D1FC 00000040            288              ADD.L   #DMMBSIZE,A0
00001132  51C8 FFF4                289              DBRA.W  D0,.LOOP
00001136  4CDF 0101                290              MOVEM.L (A7)+,D0/A0
0000113A  4E75                     291              RTS
0000113C                           292  
0000113C                           293  ; -----------------------------------------------------------------------------
0000113C                           294  DMMFIRST
0000113C                           295  ; SEARCHES THE FIRST MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
0000113C                           296  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
0000113C                           297  ; INPUT    - NONE
0000113C                           298  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
0000113C                           299  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000113C                           300  ; -----------------------------------------------------------------------------
0000113C  41F9 00001FC0            301              LEA     DMMDATA,A0
00001142  4A58                     302  DMMFRLOP    TST.W   (A0)+
00001144  6600 0016                303              BNE     DMMFRFND
00001148  D1FC 0000003E            304              ADD.L   #DMMBSIZE-2,A0
0000114E  B1FC 00002C3F            305  DMMFRCOM    CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
00001154  6DEC                     306              BLT     DMMFRLOP
00001156  207C 00000000            307              MOVE.L  #0,A0
0000115C  4E75                     308  DMMFRFND    RTS
0000115E                           309  
0000115E                           310  ; -----------------------------------------------------------------------------
0000115E                           311  DMMNEXT
0000115E                           312  ; SEARCHES THE NEXT MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
0000115E                           313  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
0000115E                           314  ; INPUT    - A0   : POINTER WITHIN THE CURRENT SLOT
0000115E                           315  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
0000115E                           316  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000115E                           317  ; -----------------------------------------------------------------------------
0000115E  2F00                     318              MOVE.L  D0,-(A7)
00001160  2008                     319              MOVE.L  A0,D0
00001162  C0BC FFFFFFC0            320              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
00001168  0680 00000040            321              ADD.L   #DMMBSIZE,D0
0000116E  2040                     322              MOVE.L  D0,A0
00001170  201F                     323              MOVE.L  (A7)+,D0
00001172  60DA                     324              BRA     DMMFRCOM
00001174                           325  
00001174                           326  ; -----------------------------------------------------------------------------
00001174                           327  DMMFRSTO
00001174                           328  ; SEARCHES THE FIRST MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
00001174                           329  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001174                           330  ; INPUT    - D0.W : ID TO SEARCH
00001174                           331  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001174                           332  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001174                           333  ; -----------------------------------------------------------------------------
00001174  41F9 00001FC0            334              LEA     DMMDATA,A0
0000117A  B058                     335  DMMFLOOP    CMP.W   (A0)+,D0
0000117C  6700 0016                336              BEQ     DMMFFND
00001180  D1FC 0000003E            337              ADD.L   #DMMBSIZE-2,A0
00001186  B1FC 00002C3F            338  DMMFCOM     CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
0000118C  6DEC                     339              BLT     DMMFLOOP
0000118E  207C 00000000            340              MOVE.L  #0,A0
00001194  4E75                     341  DMMFFND     RTS
00001196                           342  
00001196                           343  ; -----------------------------------------------------------------------------
00001196                           344  DMMNEXTO
00001196                           345  ; SEARCHES THE NEXT MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
00001196                           346  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00001196                           347  ; INPUT    - D0.W : ID TO SEARCH
00001196                           348  ;            A0   : POINTER WITHIN THE CURRENT SLOT
00001196                           349  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00001196                           350  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00001196                           351  ; -----------------------------------------------------------------------------
00001196  2F00                     352              MOVE.L  D0,-(A7)
00001198  2008                     353              MOVE.L  A0,D0
0000119A  C0BC FFFFFFC0            354              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
000011A0  0680 00000040            355              ADD.L   #DMMBSIZE,D0
000011A6  2040                     356              MOVE.L  D0,A0
000011A8  201F                     357              MOVE.L  (A7)+,D0
000011AA  60DA                     358              BRA     DMMFCOM
000011AC                           359  
000011AC                           360  ; -----------------------------------------------------------------------------
000011AC                           361  DMMALLOC
000011AC                           362  ; SEARCHES THE FIRST FREE (SYS OWNED) SLOT, ASSIGNS TO THE SPECIFIED OWNER
000011AC                           363  ; AND RETURNS A POINTER TO THE CORRESPONDING DATA (SLOT ADDRESS + 2)
000011AC                           364  ; INPUT    - D0.W : ID TO ASSIGN
000011AC                           365  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FREE SPACE
000011AC                           366  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000011AC                           367  ; -----------------------------------------------------------------------------
000011AC  3F00                     368              MOVE.W  D0,-(A7)
000011AE  4240                     369              CLR.W   D0
000011B0  4EB8 1174                370              JSR     DMMFRSTO
000011B4  301F                     371              MOVE.W  (A7)+,D0
000011B6  B1FC 00000000            372              CMP.L   #0,A0
000011BC  6700 0006                373              BEQ     .END
000011C0  3140 FFFE                374              MOVE.W  D0,-2(A0)
000011C4  4E75                     375  .END        RTS
000011C6                           376  
000011C6                           377  ; -----------------------------------------------------------------------------
000011C6                           378  DMMFREE
000011C6                           379  ; FREES THE SLOT TO WHICH THE PROVIDED POINTER BELONGS BY SETTING ITS OWNED TO
000011C6                           380  ; SYSTEM (0)
000011C6                           381  ; INPUT    - A0   : POINTER BELONGING TO THE SLOT TO FREE
000011C6                           382  ; OUTPUT   - NONE
000011C6                           383  ; MODIFIES - NONE
000011C6                           384  ; -----------------------------------------------------------------------------
000011C6  48E7 8080                385              MOVEM.L D0/A0,-(A7)
000011CA  2008                     386              MOVE.L  A0,D0
000011CC  C0BC FFFFFFC0            387              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
000011D2  2040                     388              MOVE.L  D0,A0
000011D4  4250                     389              CLR.W   (A0)
000011D6  4CDF 0101                390              MOVEM.L (A7)+,D0/A0
000011DA  4E75                     391              RTS
000011DC                           392  
000011DC                           393  -------------------- end include --------------------
000011DC                           394              INCLUDE "CONSTANTS.X68"         ; USER CONSTANTS
000011DC                           395  ; =============================================================================
000011DC                           396  ; CONSTANTS
000011DC                           397  ; =============================================================================
000011DC                           398  
000011DC                           399  ; --- TEXT RELATED CONSTANTS --------------------------------------------------
000011DC  =0000000E                400  INTTITX     EQU     14                      ; TITLE X COORDINATE
000011DC  =00000007                401  INTTITY     EQU     7                       ; TITLE Y COORDINATE
000011DC  =00DCAA7C                402  INTTITC     EQU     $00DCAA7C               ; TITLE COLOR
000011DC  =00000020                403  INTPRSX     EQU     32                      ; PRESS FIRE X COORDINATE
000011DC  =00000052                404  INTPRSY     EQU     82                      ; PRESS FIRE Y COORDINATE
000011DC  =00FFFFFF                405  INTPRSC     EQU     $00FFFFFF               ; PRESS FIRE COLOR
000011DC  =00000012                406  TXBSIZE     EQU     18                      ; BIG SIZE LETTERS
000011DC  =00000010                407  TXMSIZE     EQU     16                      ; MEDIUM SIZE LETTERS
000011DC  =0000000A                408  TXSSIZE     EQU     10                      ; SMALL SIZE LETTERS
000011DC  =00000012                409  GOVERX      EQU     18                      ; GAME OVER X COORDINATE
000011DC  =00000007                410  GOVERY      EQU     7                       ; GAME OVER Y COORDINATE
000011DC  =0000FFFF                411  GOVERC      EQU     $0000FFFF               ; GAME OVER COLOR
000011DC                           412  
000011DC                           413  ; --- STATES GAME -------------------------------------------------------------
000011DC  =FFFFFFFF                414  STANONE     EQU     -1                      ; PLACEHOLDER TO FORCE CHANGE
000011DC  =00000000                415  STAINTR     EQU     0                       ; INTRO/PRESS FIRE STATE
000011DC  =00000001                416  STASPACE    EQU     1                       ; WAITS PRESS FIER TO MOVE THE BALL
000011DC  =00000002                417  STAPLAY     EQU     2                       ; NORMAL GAME STATE
000011DC  =00000003                418  STAGOVR     EQU     3                       ; GAME OVER STATE
000011DC  =00000004                419  STAWIN      EQU     4                       ; WIN STATE
000011DC                           420  
000011DC                           421  ; --- SCREENCTRL --------------------------------------------------------------
000011DC  =00000201                422  SCRCTRL     EQU     513                     ; COORDINATE X OF DATA SCREEN
000011DC  =00000005                423  SCRLWIDTH   EQU     5                       ; WIDTH OF THE DATA SCREEN
000011DC  =000000C8                424  SCRRNKY     EQU     200                     ; POSITION X OF THE RNK SCREEN
000011DC  =00000040                425  LIVEWIDTH   EQU     64                      ; WIDTH OF THE LIVE BAR
000011DC  =00000010                426  LIVEHEIGHT  EQU     16                      ; HEIGHT OF THE LIFE BAR
000011DC  =006666FF                427  LIVECOLOR   EQU     $006666FF               ; RED COLOR OF THE LIFE BAR
000011DC  =00000215                428  LIVEPOSX    EQU     SCRCTRL+20              ; LIFE BAR X COORDINATE
000011DC  =0000001E                429  LIVEPOSY    EQU     30                      ; LIFE BAR Y COORDINATE
000011DC= 73 63 6F 72 65 2E ...    430  FILE        DC.B    'score.txt',0           ; SCORES' FILE
000011E6                           431  
000011E6                           432  ; -- PLAYER -------------------------------------------------------------------
000011E6  =00000040                433  PINWIDTH1    EQU     64                     ; PLAYER INITIAL WIDTH 
000011E6  =00000036                434  PINWIDTH2    EQU     54                     ; PLAYER LEVEL2 WIDTH
000011E6  =0000002C                435  PINWIDTH3    EQU     44                     ; PLAYER LEVEL3 WIDTH
000011E6  =0000000C                436  PHEIGHT      EQU     12                     ; PLAYER HEIGHT (PIXELS)
000011E6  =00ECD59D                437  PCOLOR       EQU     $00ECD59D              ; PLAYER COLOR
000011E6  =00000003                438  PINLIVE      EQU     3                      ; PLAYER INTIAL LIVES 
000011E6  =00000008                439  PMOVE        EQU     8                      ; SPEED OF THE PLAYER
000011E6  =000001D0                440  PPOSY        EQU     SCRHEIGH-PHEIGHT-4     ; POSICION DE LA PLATAFORMA Y)
000011E6  =000000E0                441  PINPOSX1     EQU     SCRCTRL/2-PINWIDTH1/2  ; PLAYER LVL1 COORDINATE X
000011E6  =000000E5                442  PINPOSX2     EQU     SCRCTRL/2-PINWIDTH2/2  ; PLAYER LVL2 COORDINATE X
000011E6  =000000EA                443  PINPOSX3     EQU     SCRCTRL/2-PINWIDTH3/2  ; PLAYER LVL3 COORDINATE X
000011E6  =0000003E                444  PSCORETX     EQU     62                     ; SCORE X COORDINATE
000011E6  =00000006                445  PSCORETY     EQU     6                      ; SCORE Y COORDINATE
000011E6  =00FFFFFF                446  PSCORECOL    EQU     $00FFFFFF
000011E6                           447  
000011E6                           448  ; --- BALL --------------------------------------------------------------------
000011E6  =0000000A                449  BDIAMET     EQU     10                      ; DIAMETER OF THE BALL
000011E6  =000000FB                450  BINPOSX     EQU     SCRCTRL/2-BDIAMET/2     ; BALL X INITIAL COORDINATE 
000011E6  =000001CE                451  BINPOSY     EQU     PPOSY-2                 ; BALL Y INITIAL COORDINATE 
000011E6  =FFFFFFFD                452  BINSPEED    EQU     -3                      ; INITIAL SPEED
000011E6  =00FFFFFF                453  BINCOLOR    EQU     $00FFFFFF               ; BALL COLOR
000011E6                           454  
000011E6                           455  ; --- BLOCKS ------------------------------------------------------------------
000011E6  =00000040                456  BLWIDTH     EQU     64                      ; BLOCKS WIDTH
000011E6  =00000010                457  BLHEIGHT    EQU     16                      ; BLOCKS HEIGHT
000011E6= 00F7E78E 004E8CF3 ...    458  COLORS      DC.L    BLUE,ORANGE,PURPLE,YELLOW,GREEN,BLUE,ORANGE,PURPLE,YELLOW,GREEN,BLUE,ORANGE
00001216                           459  ; BLOCKS DIFFERENT COLORS
00001216  =0000000C                460  BLROW       EQU     12                      ; ROWS OF BLOCKS
00001216  =00000008                461  BLCOL       EQU     8                       ; COLUMS OF BLOCKS
00001216                           462  
00001216                           463  ; --- COLORS ------------------------------------------------------------------
00001216  =004E8CF3                464  ORANGE      EQU     $004E8CF3
00001216  =00F7E78E                465  BLUE        EQU     $00F7E78E
00001216  =00FFACAC                466  PURPLE      EQU     $00FFACAC
00001216  =0038EEF8                467  YELLOW      EQU     $0038EEF8
00001216  =0095FF8C                468  GREEN       EQU     $0095FF8C
00001216                           469  ; --- RANKING TABLE -----------------------------------------------------------
00001216                           470  
00001216  =00000011                471  RNKPOSR     EQU     17                      ; POSITION ROW
00001216  =0000003C                472  RNKPSCC     EQU     60                      ; COLUMN POSITION FOR SCORE
00001216  =00000046                473  RNKPNAC     EQU     70                      ; COLUMN POSITION FOR NAME
00001216                           474  
00001216                           475  
00001216                           476  
00001216                           477  
00001216                           478  -------------------- end include --------------------
00001216                           479              INCLUDE "UTIL.X68"              ; UTILITY MACRO AND SUBROUTINES
00001216                           480  ; =============================================================================
00001216                           481  ; UTILITY MACROS
00001216                           482  ; =============================================================================
00001216                           483  
00001216                           484  UTLSPEN     MACRO
00001216                           485  ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001216                           486  ; INPUT    - \1 COLOR IN FORMAT $00BBGGRR
00001216                           487  ; OUTPUT   - NONE
00001216                           488  ; MODIFIES - D0,D1
00001216                           489  ; -----------------------------------------------------------------------------
00001216                           490              MOVE.B  #80,D0
00001216                           491              MOVE.L  \1,D1
00001216                           492              TRAP    #15
00001216                           493              ENDM
00001216                           494  ; -----------------------------------------------------------------------------
00001216                           495  UTLSFIL     MACRO
00001216                           496  ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001216                           497  ; INPUT    - \1 COLOR IN FORMAT $00BBGGRR
00001216                           498  ; OUTPUT   - NONE
00001216                           499  ; MODIFIES - D0,D1
00001216                           500  ; -----------------------------------------------------------------------------
00001216                           501              MOVE.B  #81,D0
00001216                           502              MOVE.L  \1,D1
00001216                           503              TRAP    #15
00001216                           504              ENDM
00001216                           505              
00001216                           506  ; -----------------------------------------------------------------------------
00001216                           507  UTLLOCT     MACRO
00001216                           508  ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001216                           509  ; INPUT    - \1 X, \2 Y
00001216                           510  ; OUTPUT   - NONE
00001216                           511  ; MODIFIES - D0,D1
00001216                           512  ; -----------------------------------------------------------------------------
00001216                           513              MOVE.W  #\1<<8|\2, D1
00001216                           514              MOVE.B  #11,D0
00001216                           515              TRAP    #15
00001216                           516              ENDM
00001216                           517  ; -----------------------------------------------------------------------------
00001216                           518  UTLSIZC     MACRO
00001216                           519  ; WRAPPER FOR SET SIZE AND COLOR TRAP 15 TASK.
00001216                           520  ; INPUT    - \1 COLOR IN FORMAT $00BBGGRR \2 SIZE (8, 9, 10, 12, 14, 16, 18))
00001216                           521  ; OUTPUT   - NONE
00001216                           522  ; MODIFIES - D0,D1
00001216                           523  ; -----------------------------------------------------------------------------
00001216                           524              MOVE.L  \1,D1
00001216                           525              MOVE.L  #\2<<16|1,D2
00001216                           526              MOVE.B  #21,D0
00001216                           527              TRAP    #15
00001216                           528              ENDM
00001216                           529  ; -----------------------------------------------------------------------------
00001216                           530  UTLSNDS     MACRO
00001216                           531  ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
00001216                           532  ; INPUT    - \1 ADDRESS TO STRING WITH NAME OF THE FILE, \2 NUM SOUNDS, 
00001216                           533  ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001216                           534  ; MODIFIES - D0,A1
00001216                           535  ; -----------------------------------------------------------------------------
00001216                           536              LEA     \1, A1             ;PLAY EXPLOSION SOUND
00001216                           537              MOVE.W  \2,D1
00001216                           538              MOVE.B  #71,D0
00001216                           539              TRAP    #15
00001216                           540              MOVE.B  #72,D0
00001216                           541              TRAP    #15
00001216                           542              ENDM
00001216                           543  ; -----------------------------------------------------------------------------
00001216                           544  UTLSNDST     MACRO
00001216                           545  ; WRAPPER FOR STOPPING WAV FILE TRAP 15 TASK
00001216                           546  ; INPUT    - NONE 
00001216                           547  ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001216                           548  ; MODIFIES - D0,A1
00001216                           549  ; -----------------------------------------------------------------------------
00001216                           550              MOVE.L  #3,D2
00001216                           551              MOVE.B  #76,D0
00001216                           552              TRAP    #15
00001216                           553              ENDM
00001216                           554  ; -----------------------------------------------------------------------------            
00001216                           555  UTLSVNAME  
00001216                           556  ; WRAPPER FOR SAVING THE NAME OF THE PLAYER
00001216                           557  ; MAX CARACTERS: 20
00001216                           558  ; -----------------------------------------------------------------------------
00001216  48E7 8040                559              MOVEM.L D0/A1,-(A7)
0000121A  4239 00002C50            560              CLR.B   PNAME
00001220  43F9 0000123E            561              LEA.L   .INSTRUCT,A1            
00001226  103C 000E                562              MOVE.B  #14,D0
0000122A  4E4F                     563              TRAP    #15
0000122C  43F9 00002C50            564              LEA.L   PNAME,A1                ; SAVES IN PNAME
00001232  103C 0002                565              MOVE.B  #2,D0
00001236  4E4F                     566              TRAP    #15
00001238  4CDF 0201                567              MOVEM.L (A7)+,D0/A1
0000123C  4E75                     568              RTS
0000123E= 45 4E 54 45 52 20 ...    569  .INSTRUCT   DC.B    'ENTER YOUR NAME (MAX. 6 LETTERS): ',0
00001262= 0000                     570              DC.W    0
00001264                           571           
00001264                           572  ; -----------------------------------------------------------------------------
00001264                           573  ; =============================================================================
00001264                           574  ; UTILITY SUBROUTINES
00001264                           575  ; =============================================================================
00001264                           576  ; -----------------------------------------------------------------------------
00001264                           577  UTLINTRI
00001264                           578  ; PLOTS THE TITLE OF THE GAME
00001264                           579  ; INPUT    - NONE
00001264                           580  ; OUTPUT   - NONE
00001264                           581  ; MODIFIES - NONE
00001264                           582  ; -----------------------------------------------------------------------------
00001264  48E7 E040                583              MOVEM.L D0-D2/A1,-(A7)
00001268                           584              ;TITULO
00001268                           585m             UTLLOCT INTTITX,INTTITY      
00001268                           586m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001268                           587m ; INPUT    - INTTITX X, INTTITY Y
00001268                           588m ; OUTPUT   - NONE
00001268                           589m ; MODIFIES - D0,D1
00001268                           590m ; -----------------------------------------------------------------------------
00001272                           591m             UTLSIZC #INTTITC,TXBSIZE
00001272                           592m ; WRAPPER FOR SET SIZE AND COLOR TRAP 15 TASK.
00001272                           593m ; INPUT    - #INTTITC COLOR IN FORMAT $00BBGGRR TXBSIZE SIZE (8, 9, 10, 12, 14, 16, 18))
00001272                           594m ; OUTPUT   - NONE
00001272                           595m ; MODIFIES - D0,D1
00001272                           596m ; -----------------------------------------------------------------------------
00001284  43F9 00001296            597              LEA     .TITSTR,A1            
0000128A  103C 000E                598              MOVE.B  #14,D0
0000128E  4E4F                     599              TRAP    #15
00001290  4CDF 0207                600              MOVEM.L (A7)+,D0-D2/A1
00001294  4E75                     601              RTS
00001296= 42 72 65 61 6B 69 ...    602  .TITSTR     DC.B    'Breaking Blocks',0
000012A6= 0000                     603              DC.W    0
000012A8                           604  ; -----------------------------------------------------------------------------
000012A8                           605  UTLCHCOLW
000012A8                           606  ; CHECKS COLLISION WITH WALL
000012A8                           607  ; INPUT    - D0.W BPOSX1
000012A8                           608  ;            D1.W BPOSY1
000012A8                           609  ;            D2.W BPOSX2
000012A8                           610  ;            D3.W BPOSY2
000012A8                           611  ; OUTPUT   - NONE
000012A8                           612  ; MODIFIES - NONE
000012A8                           613  ; -----------------------------------------------------------------------------
000012A8  48E7 F080                614              MOVEM.L D0-D3/A0,-(A7)
000012AC  41F9 0000138A            615              LEA.L   .COLLIS,A0
000012B2  B258                     616              CMP.W   (A0)+,D1                ; UP
000012B4  6E00 001C                617              BGT     .LEFT
000012B8  4479 00002C5A            618              NEG.W   BSPEEDY
000012BE  4279 00002C64            619              CLR.W   BPOSY1
000012C4  33FC 000A 00002C66       620              MOVE.W  #BDIAMET,BPOSY2
000012CC  4EF9 00001384            621              JMP     .END 
000012D2                           622  .LEFT        
000012D2  B058                     623              CMP.W   (A0)+,D0
000012D4  6E00 001C                624              BGT     .RIGHT
000012D8  4479 00002C58            625              NEG.W   BSPEEDX
000012DE  4279 00002C60            626              CLR.W   BPOSX1
000012E4  33FC 000A 00002C62       627              MOVE.W  #BDIAMET,BPOSX2
000012EC  4EF9 00001384            628              JMP     .END
000012F2                           629  .RIGHT      
000012F2  B458                     630              CMP.W   (A0)+,D2
000012F4  6D00 001E                631              BLT     .DOWN
000012F8  4479 00002C58            632              NEG.W   BSPEEDX
000012FE  33FC 0201 00002C62       633              MOVE.W  #SCRCTRL,BPOSX2
00001306  33FC 01F7 00002C60       634              MOVE.W  #SCRCTRL-BDIAMET,BPOSX1
0000130E  4EF9 00001384            635              JMP     .END
00001314                           636  .DOWN       
00001314  B658                     637              CMP.W   (A0)+,D3         
00001316  6E00 0008                638              BGT     .MINLIVE                  
0000131A  4EF9 00001384            639              JMP     .END  
00001320                           640  .MINLIVE                                    ; MINUS ONE LIVE
00001320                           641m             UTLSNDS .SOUNDL,#1              
00001320                           642m ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
00001320                           643m ; INPUT    - .SOUNDL ADDRESS TO STRING WITH NAME OF THE FILE, #1 NUM SOUNDS, 
00001320                           644m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001320                           645m ; MODIFIES - D0,A1
00001320                           646m ; -----------------------------------------------------------------------------
00001336  33FC 01E0 00002C66       647              MOVE.W  #SCRHEIGH,BPOSY2
0000133E  33FC 01D6 00002C64       648              MOVE.W  #SCRHEIGH-BDIAMET,BPOSY1 
00001346  5379 00002C48            649              SUB.W   #1,PLIVES                
0000134C  6600 002E                650              BNE     .RESET               
00001350                           651m             UTLSNDST
00001350                           652m ; WRAPPER FOR STOPPING WAV FILE TRAP 15 TASK
00001350                           653m ; INPUT    - NONE 
00001350                           654m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001350                           655m ; MODIFIES - D0,A1
00001350                           656m ; -----------------------------------------------------------------------------
00001358                           657m             UTLSNDS .SOUNDG,#1
00001358                           658m ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
00001358                           659m ; INPUT    - .SOUNDG ADDRESS TO STRING WITH NAME OF THE FILE, #1 NUM SOUNDS, 
00001358                           660m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001358                           661m ; MODIFIES - D0,A1
00001358                           662m ; -----------------------------------------------------------------------------
0000136E  33FC 0003 00002C42       663              MOVE.W  #STAGOVR,(STANEXT)      ; IF PLAYER LOST ALL THE LIVES
00001376  4EF9 00001384            664              JMP     .END
0000137C                           665  .RESET                                      
0000137C  33FC 0001 00002C42       666              MOVE.W  #STASPACE,(STANEXT) 
00001384                           667             
00001384                           668  .END        
00001384  4CDF 010F                669              MOVEM.L (A7)+,D0-D3/A0
00001388  4E75                     670              RTS
0000138A= 0000 0000 0201 01E0      671  .COLLIS     DC.W    0,0,SCRCTRL,SCRHEIGH
00001392= 67616D65 206F7665 ...    672  .SOUNDG     DC.L    'game over.wav',0
000013A6= 6C6F7365 206C6966 ...    673  .SOUNDL     DC.L    'lose life.wav',0
000013BA                           674  ; -----------------------------------------------------------------------------
000013BA                           675  UTLCHCOLP
000013BA                           676  ; CHECKS COLLISION WITH PLATAFORM
000013BA                           677  ; INPUT    - D0.W BPOSX1
000013BA                           678  ;            D1.W BPOSY1
000013BA                           679  ;            D2.W PPOSX2
000013BA                           680  ;            D3.W PPOSY2
000013BA                           681  ; OUTPUT   - NONE
000013BA                           682  ; MODIFIES - NONE
000013BA                           683  ; -----------------------------------------------------------------------------
000013BA  48E7 FC00                684              MOVEM.L D0-D5,-(A7)
000013BE  383C 01D0                685              MOVE.W  #PPOSY,D4
000013C2  B644                     686              CMP.W   D4,D3
000013C4  6D00 0086                687              BLT     .END                    ;SI ESTÁ MÁS A ARRIBA DE LA PLATAFORMA NO HAY COLISIÓN
000013C8  3839 00002C44            688              MOVE.W  PPOSX,D4
000013CE  B444                     689              CMP.W   D4,D2
000013D0  6D00 007A                690              BLT     .END                    ;SI ESTÁ MÁS A LA IZQUIERDA DE LA PLATAFORMA NO HAY COLISIÓN
000013D4  D879 00002C46            691              ADD.W   PWIDTH,D4
000013DA  B044                     692              CMP.W    D4,D0
000013DC  6E00 006E                693              BGT     .END                    ;SI ESTÁ MÁS A LA DERECHA NO HAY COLISIÓN
000013E0                           694              ;AQUÍ HAY COLISIÓN, TENEMOS QUE DETECTAR CUAL
000013E0  383C 01D0                695              MOVE.W  #PPOSY,D4
000013E4  B244                     696              CMP.W   D4,D1
000013E6  6E00 005E                697              BGT     .LADOS
000013EA  4479 00002C5A            698              NEG.W   BSPEEDY                 ;COLISIÓN CON LA PARTE DE ARRIBA
000013F0  33C4 00002C66            699              MOVE.W  D4,BPOSY2
000013F6  0444 000A                700              SUB.W   #BDIAMET,D4
000013FA  33C4 00002C64            701              MOVE.W  D4,BPOSY1       
00001400                           702  .PLRXMIDDLE 
00001400  3839 00002C46            703              MOVE.W  PWIDTH,D4
00001406  E24C                     704              LSR.W   #1,D4
00001408  3A39 00002C44            705              MOVE.W  PPOSX,D5 
0000140E  DA44                     706              ADD.W   D4,D5                   ;D5 = CENTRO PLATAFORMA
00001410  BA42                     707              CMP.W   D2,D5                   ;CENTRO - POS PEL
00001412  6B00 001A                708              BMI     .PLRXRIGHT
00001416  3839 00002C58            709              MOVE.W  BSPEEDX,D4
0000141C  6B00 002E                710              BMI     .END
00001420                           711                                           
00001420  4444                     712              NEG.W   D4
00001422  33C4 00002C58            713              MOVE.W  D4,BSPEEDX
00001428  4EF9 0000144C            714              JMP     .END
0000142E                           715              
0000142E                           716  .PLRXRIGHT             
0000142E  3839 00002C58            717              MOVE.W  BSPEEDX,D4
00001434  6A00 0016                718              BPL     .END              ;SI ES POSITIVO SOLO NEGAMOS Y
00001438  4444                     719              NEG.W   D4
0000143A  33C4 00002C58            720              MOVE.W  D4,BSPEEDX
00001440  4EF9 0000144C            721              JMP     .END
00001446                           722  
00001446                           723  .LADOS      
00001446  4479 00002C58            724              NEG.W   BSPEEDX                 ;COLISIÓN CON LOS LADOS
0000144C                           725  .END        
0000144C  4CDF 003F                726              MOVEM.L (A7)+,D0-D5 
00001450  4E75                     727              RTS
00001452                           728  ; -----------------------------------------------------------------------------
00001452                           729  UTLCOLBL   
00001452                           730  ; CHECKS COLLISION WITH BLOCKS
00001452                           731  ; INPUT    - 
00001452                           732  ; OUTPUT   
00001452                           733  ; MODIFIES - NONE
00001452                           734  ; -----------------------------------------------------------------------------
00001452  E849                     735              LSR.W   #4,D1           ;POSY/BLHEIGHT. D1 -> FILA
00001454  343C 000B                736              MOVE.W  #BLROW-1,D2
00001458  B441                     737              CMP.W   D1,D2           ;SI ESTÁ POR DEBAJO DE LA ÚLTIMA FILA SALTA DIRECTO A END
0000145A  6D00 00D2                738              BLT     .ENDNOCOLISION                    
0000145E  41F9 00002C6A            739              LEA.L   BLMATRIX,A0
00001464  D1C1                     740              ADDA.L  D1,A0           ;CARGAMOS EN A0 LA DIRECCIÓN DEL BYTE DE LA FILA
00001466                           741                                          
00001466  EC48                     742              LSR.W   #6,D0           ;D0 -> COLUMNA 
00001468  363C 0007                743              MOVE.W  #BLCOL-1,D3                           
0000146C  9640                     744              SUB.W   D0,D3           ;D3 -> COLUMNA (DESDE DRCHA) DONDE ESTÁ LA BOLA
0000146E  3E03                     745              MOVE.W  D3,D7
00001470  6A00 0004                746              BPL     .TEST  
00001474  4283                     747              CLR.L   D3              ;POR SI SALE NEGATIVO LA REAJUSTAMOS
00001476                           748  .TEST
00001476  0710                     749              BTST.B  D3,(A0)         ;MIRAMOS EL BIT DONDE ESTA 
00001478  6700 00B4                750              BEQ     .ENDNOCOLISION  ; SALTA SI EN ESA POSICION YA HABIA UN 0
0000147C                           751  
0000147C                           752  .IZQ        
0000147C  EC4D                     753              LSR.W   #6,D5           ;D5 -> COLUMNA
0000147E  343C 0007                754              MOVE.W  #BLCOL-1,D2
00001482  9445                     755              SUB.W   D5,D2           ;D2 -> COLUMNA (DESDE DERECHA) DONDE ESTA EL PUNTO CONTRARIO (SI 1 ENTONCES 2)
00001484  B443                     756              CMP     D3,D2                  
00001486  6F00 000E                757              BLE     .CHOQUEDOBLE
0000148A  4479 00002C58            758              NEG.W   BSPEEDX
00001490                           759              
00001490  4EF9 000014EE            760              JMP     .ENDCOLISION    ;  (|)______|  COLISION DELADO IZQUIERDO COLISIONANDO POR LA IZQ DEL NLOQUE 
00001496                           761              
00001496                           762  .CHOQUEDOBLE                        ;SI ESTA EN MEDIO DEL BLOQUE  |___()___| COLISION EN MEDIO
00001496                           763                                      ;COMPARAMOS SI LE HA DADO A DOS A LA VEZ |______(|)______|
00001496  B443                     764              CMP     D3,D2
00001498  6700 0036                765              BEQ     .ENMEDIO
0000149C                           766              
0000149C  5A40                     767              ADDI.W  #BDIAMET/2,D0
0000149E  EC48                     768              LSR.W   #6,D0
000014A0  3A3C 0007                769              MOVE.W  #BLCOL-1,D5     ;D1 -> COLUMNA DONDE SE ENCUENTRA EL PUNTO MEDIO DE LA BOLA                         
000014A4                           770              
000014A4  9A40                     771              SUB.W   D0,D5
000014A6  6A00 0004                772              BPL     .TEST2  
000014AA  4285                     773              CLR.L   D5              ;POR SI SALE NEGATIVO LA REAJUSTAMOS
000014AC                           774  .TEST2
000014AC                           775              
000014AC  0B10                     776              BTST.B  D5,(A0)         ;MIRAMOS EL BIT DONDE ESTA 
000014AE  6700 0020                777              BEQ     .ENMEDIO
000014B2  BE45                     778              CMP     D5,D7
000014B4  6700 000E                779              BEQ     .CHOQUEDOBLEIZQ
000014B8  4479 00002C5A            780              NEG.W   BSPEEDY
000014BE  4EF9 000014EE            781              JMP     .ENDCOLISION
000014C4                           782  .CHOQUEDOBLEIZQ
000014C4  4479 00002C58            783              NEG.W   BSPEEDX
000014CA  4EF9 000014EE            784              JMP     .ENDCOLISION
000014D0                           785  
000014D0                           786              
000014D0                           787  .ENMEDIO            
000014D0                           788              ;COMPARAMOS SI LA PARTE CONTRARIA ESTA DENTO DEL BLOQUE O FUERA
000014D0  B443                     789              CMP     D3,D2
000014D2  6D00 000E                790              BLT     .DERECHA
000014D6  4479 00002C5A            791              NEG.W   BSPEEDY
000014DC  4EF9 000014EE            792              JMP     .ENDCOLISION
000014E2                           793  .DERECHA
000014E2  4479 00002C58            794              NEG.W   BSPEEDX
000014E8  4EF9 000014EE            795              JMP     .ENDCOLISION
000014EE                           796              
000014EE                           797  
000014EE                           798  .ENDCOLISION
000014EE  383C 0001                799              MOVE.W  #1,D4
000014F2  0790                     800              BCLR    D3,(A0)      
000014F4  0679 0064 00002C4A       801              ADD.W   #100,PSCORE
000014FC  5379 00002C68            802              SUB.W   #1,BLCOUNTER
00001502  3039 00002C68            803              MOVE.W  BLCOUNTER,D0
00001508  B07C 0000                804              CMP     #0,D0
0000150C  6700 0020                805              BEQ     .ENDNOCOLISION
00001510                           806m             UTLSNDST
00001510                           807m ; WRAPPER FOR STOPPING WAV FILE TRAP 15 TASK
00001510                           808m ; INPUT    - NONE 
00001510                           809m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001510                           810m ; MODIFIES - D0,A1
00001510                           811m ; -----------------------------------------------------------------------------
00001518                           812m             UTLSNDS  .SOUND,#1
00001518                           813m ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
00001518                           814m ; INPUT    - .SOUND ADDRESS TO STRING WITH NAME OF THE FILE, #1 NUM SOUNDS, 
00001518                           815m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001518                           816m ; MODIFIES - D0,A1
00001518                           817m ; -----------------------------------------------------------------------------
0000152E                           818              
0000152E                           819  .ENDNOCOLISION
0000152E  4E75                     820              RTS
00001530= 626C6F63 6B732E77 ...    821  .SOUND      DC.L    'blocks.wav',0
00001540                           822  
00001540                           823  ; -----------------------------------------------------------------------------
00001540                           824  UTLSREENP   
00001540                           825  ; PLOTS THE SEPARATION BETWEEN THE GAME AND THE SCREENCTRL AND THE RNKTABLE
00001540                           826  ; INPUT    - NONE
00001540                           827  ; OUTPUT   - NONE
00001540                           828  ; MODIFIES - NONE
00001540                           829  ; -----------------------------------------------------------------------------
00001540  48E7 FC40                830              MOVEM.L D0-D5/A1,-(A7)    
00001544                           831m             UTLSPEN #$00FFFFFF
00001544                           832m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001544                           833m ; INPUT    - #$00FFFFFF COLOR IN FORMAT $00BBGGRR
00001544                           834m ; OUTPUT   - NONE
00001544                           835m ; MODIFIES - D0,D1
00001544                           836m ; -----------------------------------------------------------------------------
00001550                           837m             UTLSFIL #$00FFFFFF
00001550                           838m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001550                           839m ; INPUT    - #$00FFFFFF COLOR IN FORMAT $00BBGGRR
00001550                           840m ; OUTPUT   - NONE
00001550                           841m ; MODIFIES - D0,D1
00001550                           842m ; -----------------------------------------------------------------------------
0000155C  103C 0057                843              MOVE.B  #87,D0
00001560  323C 0201                844              MOVE.W  #SCRCTRL,D1
00001564  363C 0206                845              MOVE.W  #SCRCTRL+SCRLWIDTH,D3
00001568  4282                     846              CLR.L   D2
0000156A  383C 01E0                847              MOVE.W  #SCRHEIGH,D4
0000156E  4E4F                     848              TRAP    #15
00001570  103C 0057                849              MOVE.B  #87,D0
00001574  323C 0201                850              MOVE.W  #SCRCTRL,D1
00001578  363C 02E4                851              MOVE.W  #SCRWIDTH,D3
0000157C  343C 00C8                852              MOVE.W  #SCRRNKY,D2
00001580  383C 00CD                853              MOVE.W  #SCRRNKY+5,D4
00001584  4E4F                     854              TRAP    #15
00001586  4CDF 023F                855              MOVEM.L (A7)+,D0-D5/A1
0000158A  4E75                     856              RTS   
0000158C= 53 43 4F 52 45 3A ...    857  .TXTSCORE   DC.B    'SCORE: ',0
00001594= 0000                     858              DC.W    0
00001596                           859  ; -----------------------------------------------------------------------------
00001596                           860  UTLREADFILE  
00001596                           861  ; READS THE FILE OF SCORE AND SAVES THE INFO IN RNKTABLE
00001596                           862  ; INPUT    - NONE
00001596                           863  ; OUTPUT   - NONE
00001596                           864  ; MODIFIES - NONE
00001596                           865  ; -----------------------------------------------------------------------------
00001596  48E7 E040                866              MOVEM.L D0-D2/A1,-(A7)
0000159A  303C 0032                867              MOVE.W  #50,D0                  ; CLOSES ALL THE FILES
0000159E  4E4F                     868              TRAP    #15
000015A0  43F9 00002C78            869              LEA.L   RNKTABLE,A1
000015A6  43F8 11DC                870              LEA     FILE,A1
000015AA  103C 0033                871              MOVE.B  #51,D0
000015AE  4E4F                     872              TRAP    #15                     ; OPENS A FILE D1 = FILE ID
000015B0  43F9 00002C78            873              LEA.L   RNKTABLE,A1
000015B6  7464                     874              MOVE.L  #100,D2                 ; BYTES TO READ: 100
000015B8  103C 0035                875              MOVE.B  #53,D0
000015BC  4E4F                     876              TRAP    #15 
000015BE  0C91 FFFFFFFF            877              CMP.L   #$FFFFFFFF,(A1)         ; IF THE RNKTABLE IS EMPTY
000015C4  6600 0004                878              BNE     .HAYALGO
000015C8  7400                     879              MOVE.L  #0,D2    
000015CA                           880  .HAYALGO
000015CA  33C2 00002C76            881              MOVE.W  D2,POSRNK
000015D0  103C 0038                882              MOVE.B  #56,D0
000015D4  4E4F                     883              TRAP    #15                     ; CLOSE THE FILE
000015D6  4CDF 0207                884              MOVEM.L (A7)+,D0-D2/A1
000015DA  4E75                     885              RTS
000015DC                           886  ; -----------------------------------------------------------------------------
000015DC                           887  UTLREADRNK  
000015DC                           888  ; READS THE RNKTABLE AND PLOTS THE SCORES WITH THE NAMES OF THE PLAYERS
000015DC                           889  ; INPUT    - NONE
000015DC                           890  ; OUTPUT   - NONE
000015DC                           891  ; MODIFIES - NONE
000015DC                           892  ; -----------------------------------------------------------------------------
000015DC  48E7 F040                893              MOVEM.L D0-D3/A1,-(A7)
000015E0                           894m             UTLSPEN #$00FFFFFF
000015E0                           895m ; WRAPPER FOR SET PEN TRAP 15 TASK.
000015E0                           896m ; INPUT    - #$00FFFFFF COLOR IN FORMAT $00BBGGRR
000015E0                           897m ; OUTPUT   - NONE
000015E0                           898m ; MODIFIES - D0,D1
000015E0                           899m ; -----------------------------------------------------------------------------
000015EC                           900m             UTLSFIL #$00000000    
000015EC                           901m ; WRAPPER FOR SET FIL TRAP 15 TASK.
000015EC                           902m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
000015EC                           903m ; OUTPUT   - NONE
000015EC                           904m ; MODIFIES - D0,D1
000015EC                           905m ; -----------------------------------------------------------------------------
000015F4                           906m             UTLLOCT RNKPSCC,RNKPOSR-2  
000015F4                           907m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
000015F4                           908m ; INPUT    - RNKPSCC X, RNKPOSR-2 Y
000015F4                           909m ; OUTPUT   - NONE
000015F4                           910m ; MODIFIES - D0,D1
000015F4                           911m ; -----------------------------------------------------------------------------
000015FE  43F9 00001662            912              LEA     .TEXT,A1            
00001604  103C 000E                913              MOVE.B  #14,D0
00001608  4E4F                     914              TRAP    #15
0000160A  3639 00002C76            915              MOVE.W  POSRNK,D3               
00001610  86FC 000A                916              DIVU.W  #10,D3
00001614  5343                     917              SUBQ.W  #1,D3                   ; D3 = NUMBER OF ELEMENTS IN RNK
00001616  B67C 0000                918              CMP     #0,D3                   
0000161A  6D00 0040                919              BLT     .END                    ; IF RNKTABLE IS EMPTY DON'T SHOW
0000161E  343C 0011                920              MOVE.W  #RNKPOSR,D2             
00001622  43F9 00002C78            921              LEA.L   RNKTABLE,A1 
00001628                           922  .LOOP
00001628  323C 3C00                923              MOVE.W  #RNKPSCC<<8,D1          ; PLACE THE SCORE
0000162C  D242                     924              ADD.W   D2,D1
0000162E  103C 000B                925              MOVE.B  #11,D0
00001632  4E4F                     926              TRAP    #15
00001634                           927              
00001634  103C 0003                928              MOVE.B  #3,D0                    ; PLOTS THE SCORE
00001638  3211                     929              MOVE.W  (A1),D1                
0000163A  4E4F                     930              TRAP    #15       
0000163C                           931                
0000163C  5489                     932              ADDA.L  #2,A1 
0000163E  323C 4600                933              MOVE.W  #RNKPNAC<<8,D1          ; PLACE THE NAME
00001642  D242                     934              ADD.W   D2,D1
00001644  103C 000B                935              MOVE.B  #11,D0
00001648  4E4F                     936              TRAP    #15    
0000164A  5242                     937              ADDQ.W  #1,D2                   ; NEXT ROW  
0000164C                           938              
0000164C  103C 0001                939              MOVE.B  #1,D0                   
00001650  323C 0008                940              MOVE.W  #8,D1                   ; PLOTS 8 BYTES = LETTERS
00001654  4E4F                     941              TRAP    #15     
00001656                           942              
00001656  5089                     943              ADDA.L  #8,A1
00001658  51CB FFCE                944              DBRA    D3,.LOOP
0000165C                           945  .END
0000165C  4CDF 020F                946              MOVEM.L (A7)+,D0-D3/A1
00001660  4E75                     947              RTS
00001662= 52 41 4E 4B 49 4E ...    948  .TEXT       DC.B    'RANKING TABLE:',0
00001672= 0000                     949              DC.W    0
00001674                           950  ; -----------------------------------------------------------------------------
00001674                           951  UTLWRRNK 
00001674                           952  ; ADDS THE PLAYER AT THE TOP OF THE TABLE
00001674                           953  ; INPUT    - NONE
00001674                           954  ; OUTPUT   - NONE
00001674                           955  ; MODIFIES - NONE
00001674                           956  ; -----------------------------------------------------------------------------         
00001674                           957      
00001674  48E7 C0E0                958              MOVEM.L D0-D1/A0-A2,-(A7)
00001678                           959              
00001678  43F9 00002C78            960              LEA.L   RNKTABLE,A1
0000167E  3239 00002C76            961              MOVE.W  POSRNK,D1
00001684  0C91 FFFFFFFF            962              CMP.L   #$FFFFFFFF,(A1)         
0000168A  6700 002E                963              BEQ     .LOAD                   ; IF THE MATRIX IS EMPTY
0000168E                           964              
0000168E                           965              ; MOVES ALL THE ELEMENTS AT THE RIGHT 
0000168E  2049                     966              MOVE.L  A1,A0            
00001690  2449                     967              MOVE.L  A1,A2
00001692  D4C1                     968              ADDA.W  D1,A2
00001694  94FC 000A                969              SUBA.W   #10,A2
00001698  D0C1                     970              ADDA.W  D1,A0                   
0000169A  82FC 000A                971              DIVU    #10,D1
0000169E  5341                     972              SUBQ.W  #1,D1
000016A0                           973  .LOOP                   
000016A0  303C 0009                974              MOVE.W  #9,D0                   ; 10 COLUMNS
000016A4                           975  .MOVER
000016A4  10DA                     976              MOVE.B  (A2)+,(A0)+             ; A2 = OLD POS, A0 = NEW POS 
000016A6  51C8 FFFC                977              DBRA    D0,.MOVER
000016AA  95FC 00000014            978              SUBA.L  #20,A2
000016B0  91FC 00000014            979              SUBA.L  #20,A0
000016B6  51C9 FFE8                980              DBRA    D1,.LOOP
000016BA                           981  .LOAD                                       ; SAVES THE NAME AT ROW = 1
000016BA  32B9 00002C4A            982              MOVE.W  PSCORE,(A1)
000016C0  5489                     983              ADDA.L  #2,A1
000016C2  303C 0007                984              MOVE.W  #7,D0                   ; NAME = 8 BYTES
000016C6  41F9 00002C50            985              LEA.L   PNAME,A0                 
000016CC                           986  .NAME
000016CC  12D8                     987              MOVE.B  (A0)+,(A1)+
000016CE  51C8 FFFC                988              DBRA    D0,.NAME          
000016D2  4CDF 0703                989              MOVEM.L (A7)+,D0-D1/A0-A2
000016D6  4E75                     990              RTS
000016D8                           991  ; -----------------------------------------------------------------------------
000016D8                           992  UTLWRFILE 
000016D8                           993  ; SAVES THE RNKTABLE IN THE FILE
000016D8                           994  ; INPUT    - NONE
000016D8                           995  ; OUTPUT   - NONE
000016D8                           996  ; MODIFIES - score.txt 
000016D8                           997  ; -----------------------------------------------------------------------------
000016D8  48E7 E040                998              MOVEM.L D0-D2/A1,-(A7)
000016DC  103C 0032                999              MOVE.B  #50,D0                  ; CLOSES ALL THE FILES
000016E0  4E4F                    1000              TRAP    #15
000016E2  43F8 11DC               1001              LEA.L   FILE,A1                 ; OPEN FILE
000016E6  103C 0033               1002              MOVE.B  #51,D0                  
000016EA  4E4F                    1003              TRAP    #15                     ; D1 = FILE ID
000016EC                          1004              
000016EC  4282                    1005              CLR.L   D2
000016EE  43F9 00002C78           1006              LEA.L   RNKTABLE,A1             
000016F4  3439 00002C76           1007              MOVE.W  POSRNK,D2  
000016FA  0642 000A               1008              ADD.W   #10,D2                  
000016FE  103C 0036               1009              MOVE.B  #54,D0                  ; WRITES THE PLAYER IN THE FILE 
00001702  4E4F                    1010              TRAP    #15
00001704                          1011             
00001704  103C 0038               1012              MOVE.B  #56,D0                  ; CLOSE THE FILE
00001708  4E4F                    1013              TRAP    #15
0000170A  4CDF 0207               1014              MOVEM.L (A7)+,D0-D2/A1
0000170E  4E75                    1015              RTS
00001710                          1016  
00001710                          1017  
00001710                          1018  
00001710                          1019  
00001710                          1020  -------------------- end include --------------------
00001710                          1021              INCLUDE "PLAYER.X68"            ; PLAYER MANAGEMENT
00001710                          1022  ; -----------------------------------------------------------------------------
00001710                          1023  ;           PLAYER
00001710                          1024  ; -----------------------------------------------------------------------------
00001710                          1025  PLRINIT
00001710                          1026  ; INITIALIZES THE PLAYER TO LEVEL 1
00001710                          1027  ; INPUT    - NONE
00001710                          1028  ; OUTPUT   - NONE
00001710                          1029  ; MODIFIES - NONE
00001710                          1030  ; -----------------------------------------------------------------------------
00001710  33FC 00E0 00002C44      1031              MOVE.W  #PINPOSX1,PPOSX
00001718  33FC 0040 00002C46      1032              MOVE.W  #PINWIDTH1,PWIDTH
00001720  4E75                    1033              RTS
00001722                          1034  ; -----------------------------------------------------------------------------
00001722                          1035  PLRLEV2
00001722                          1036  ; INITIALIZES THE PLAYER TO LEVEL 2
00001722                          1037  ; INPUT    - NONE
00001722                          1038  ; OUTPUT   - NONE
00001722                          1039  ; MODIFIES - NONE
00001722                          1040  ; -----------------------------------------------------------------------------
00001722  33FC 00E5 00002C44      1041              MOVE.W  #PINPOSX2,PPOSX
0000172A  33FC 0036 00002C46      1042              MOVE.W  #PINWIDTH2,PWIDTH
00001732  4E75                    1043              RTS        
00001734                          1044  ; -----------------------------------------------------------------------------
00001734                          1045  PLRLEV3
00001734                          1046  ; INITIALIZES THE PLAYER TO LEVEL 3
00001734                          1047  ; INPUT    - NONE
00001734                          1048  ; OUTPUT   - NONE
00001734                          1049  ; MODIFIES - NONE
00001734                          1050  ; -----------------------------------------------------------------------------
00001734  33FC 00EA 00002C44      1051              MOVE.W  #PINPOSX3,PPOSX
0000173C  33FC 002C 00002C46      1052              MOVE.W  #PINWIDTH3,PWIDTH
00001744  4E75                    1053              RTS     
00001746                          1054  ; -----------------------------------------------------------------------------
00001746                          1055  PLRUPD
00001746                          1056  ; UPDATES THE POSITION, LIVES AND SCORE OF THE PLAYER
00001746                          1057  ; INPUT     - NONE
00001746                          1058  ; OUTPUT    - NONE
00001746                          1059  ; MODIFIES  - NONE
00001746                          1060  ; -----------------------------------------------------------------------------
00001746  48E7 6000               1061              MOVEM.L D1-D2,-(A7)
0000174A  1239 00001F86           1062              MOVE.B  KBDVAL,D1  
00001750  E219                    1063              ROR.B   #1,D1                   ;IZQUIERDA
00001752  6400 0016               1064              BCC     .RIGHTKEY               ;CUANDO C = 0
00001756                          1065              ;CUANDO PPOSX ES 0 NO TINENE QUE MOVERSE MAS A LA IZQ
00001756  3439 00002C44           1066              MOVE.W  PPOSX,D2
0000175C  B47C 0000               1067              CMP.W    #0,D2
00001760  6F00 0008               1068              BLE     .RIGHTKEY
00001764  5179 00002C44           1069              SUB.W   #PMOVE,(PPOSX)
0000176A                          1070  .RIGHTKEY
0000176A  E209                    1071              LSR.B   #1,D1                   
0000176C  E219                    1072              ROR.B   #1,D1                   
0000176E  6400 001C               1073              BCC     .END
00001772                          1074              ;CUANDO PPOSX ES IGUAL A SCRWIDTH+PWIDTH NO TIENE QUE MOVERSE A LA DERECHA
00001772  3439 00002C44           1075              MOVE.W  PPOSX,D2
00001778  D479 00002C46           1076              ADD.W   PWIDTH,D2 
0000177E                          1077  
0000177E  B47C 01FC               1078              CMP.W    #SCRCTRL-SCRLWIDTH,D2
00001782  6C00 0008               1079              BGE     .END
00001786  5079 00002C44           1080              ADD.W   #PMOVE,PPOSX
0000178C                          1081  .END
0000178C  4CDF 0006               1082              MOVEM.L (A7)+,D1-D2
00001790  4E75                    1083              RTS
00001792                          1084  
00001792                          1085  ; -----------------------------------------------------------------------------
00001792                          1086  PPLOT
00001792                          1087  ; PLOTS THE PLAYER ITS LIFE AND THE SCORE
00001792                          1088  ; INPUT    - NONE
00001792                          1089  ; OUTPUT   - NONE
00001792                          1090  ; MODIFIES - NONE
00001792                          1091  ; -----------------------------------------------------------------------------
00001792  48E7 FC40               1092              MOVEM.L  D0-D5/A1,-(A7)
00001796                          1093              ;PLOT THE PLATAFORM
00001796                          1094m             UTLSPEN #PCOLOR 
00001796                          1095m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001796                          1096m ; INPUT    - #PCOLOR COLOR IN FORMAT $00BBGGRR
00001796                          1097m ; OUTPUT   - NONE
00001796                          1098m ; MODIFIES - D0,D1
00001796                          1099m ; -----------------------------------------------------------------------------
000017A2                          1100m             UTLSFIL #PCOLOR
000017A2                          1101m ; WRAPPER FOR SET FIL TRAP 15 TASK.
000017A2                          1102m ; INPUT    - #PCOLOR COLOR IN FORMAT $00BBGGRR
000017A2                          1103m ; OUTPUT   - NONE
000017A2                          1104m ; MODIFIES - D0,D1
000017A2                          1105m ; -----------------------------------------------------------------------------
000017AE  3239 00002C44           1106              MOVE.W  PPOSX,D1
000017B4  343C 01D0               1107              MOVE.W  #PPOSY,D2                    
000017B8  3639 00002C44           1108              MOVE.W  PPOSX,D3
000017BE  3839 00002C46           1109              MOVE.W  PWIDTH,D4 
000017C4  D644                    1110              ADD.W   D4,D3
000017C6  383C 01DC               1111              MOVE.W  #PPOSY+PHEIGHT,D4
000017CA  303C 0057               1112              MOVE.W  #87,D0
000017CE  4E4F                    1113              TRAP    #15
000017D0                          1114              
000017D0                          1115              ;PLOT LIFE
000017D0  3A39 00002C48           1116              MOVE.W  PLIVES,D5
000017D6  6700 00A2               1117              BEQ     .END
000017DA                          1118m             UTLSPEN #0 
000017DA                          1119m ; WRAPPER FOR SET PEN TRAP 15 TASK.
000017DA                          1120m ; INPUT    - #0 COLOR IN FORMAT $00BBGGRR
000017DA                          1121m ; OUTPUT   - NONE
000017DA                          1122m ; MODIFIES - D0,D1
000017DA                          1123m ; -----------------------------------------------------------------------------
000017E2                          1124m             UTLSFIL #LIVECOLOR
000017E2                          1125m ; WRAPPER FOR SET FIL TRAP 15 TASK.
000017E2                          1126m ; INPUT    - #LIVECOLOR COLOR IN FORMAT $00BBGGRR
000017E2                          1127m ; OUTPUT   - NONE
000017E2                          1128m ; MODIFIES - D0,D1
000017E2                          1129m ; -----------------------------------------------------------------------------
000017EE  5345                    1130              SUB.W   #1,D5             
000017F0  103C 0057               1131              MOVE.B  #87,D0
000017F4  323C 0215               1132              MOVE.W  #LIVEPOSX,D1
000017F8  3601                    1133              MOVE.W  D1,D3
000017FA  0643 0040               1134              ADD.W   #LIVEWIDTH,D3
000017FE  343C 001E               1135              MOVE.W  #LIVEPOSY,D2
00001802  3802                    1136              MOVE.W  D2,D4
00001804  0644 0010               1137              ADD.W   #LIVEHEIGHT,D4
00001808                          1138  .LIFES           
00001808  4E4F                    1139              TRAP    #15
0000180A  3203                    1140              MOVE.W  D3,D1
0000180C  0643 0040               1141              ADD.W   #LIVEWIDTH,D3
00001810  51CD FFF6               1142              DBRA    D5,.LIFES
00001814                          1143              
00001814                          1144              ;PLOT SCORE
00001814                          1145m             UTLLOCT PSCORETX,PSCORETY  
00001814                          1146m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001814                          1147m ; INPUT    - PSCORETX X, PSCORETY Y
00001814                          1148m ; OUTPUT   - NONE
00001814                          1149m ; MODIFIES - D0,D1
00001814                          1150m ; -----------------------------------------------------------------------------
0000181E                          1151m             UTLSFIL #$00000000
0000181E                          1152m ; WRAPPER FOR SET FIL TRAP 15 TASK.
0000181E                          1153m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
0000181E                          1154m ; OUTPUT   - NONE
0000181E                          1155m ; MODIFIES - D0,D1
0000181E                          1156m ; -----------------------------------------------------------------------------
00001826  43F9 00001880           1157              LEA     .TXTSCORE,A1             
0000182C  3239 00002C4A           1158              MOVE.W  PSCORE,D1
00001832  103C 0011               1159              MOVE.B  #17,D0
00001836  4E4F                    1160              TRAP    #15
00001838                          1161              
00001838                          1162              ;PLOT LEVEL
00001838                          1163m             UTLLOCT PSCORETX,PSCORETY+2  
00001838                          1164m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001838                          1165m ; INPUT    - PSCORETX X, PSCORETY+2 Y
00001838                          1166m ; OUTPUT   - NONE
00001838                          1167m ; MODIFIES - D0,D1
00001838                          1168m ; -----------------------------------------------------------------------------
00001842                          1169m             UTLSFIL #$00000000
00001842                          1170m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001842                          1171m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
00001842                          1172m ; OUTPUT   - NONE
00001842                          1173m ; MODIFIES - D0,D1
00001842                          1174m ; -----------------------------------------------------------------------------
0000184A  43F9 00001888           1175              LEA     .TXTLEVEL,A1              
00001850  3239 00002C4E           1176              MOVE.W  LEVEL,D1
00001856  103C 0011               1177              MOVE.B  #17,D0
0000185A  4E4F                    1178              TRAP    #15
0000185C                          1179              
0000185C                          1180              ;PLOT NAME
0000185C                          1181m             UTLLOCT PSCORETX,PSCORETY+4  
0000185C                          1182m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
0000185C                          1183m ; INPUT    - PSCORETX X, PSCORETY+4 Y
0000185C                          1184m ; OUTPUT   - NONE
0000185C                          1185m ; MODIFIES - D0,D1
0000185C                          1186m ; -----------------------------------------------------------------------------
00001866                          1187m             UTLSFIL #$00000000
00001866                          1188m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001866                          1189m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
00001866                          1190m ; OUTPUT   - NONE
00001866                          1191m ; MODIFIES - D0,D1
00001866                          1192m ; -----------------------------------------------------------------------------
0000186E  43F9 00002C50           1193              LEA     PNAME,A1 
00001874  103C 000E               1194              MOVE.B  #14,D0
00001878  4E4F                    1195              TRAP    #15
0000187A                          1196  
0000187A                          1197  .END            
0000187A  4CDF 023F               1198              MOVEM.L (A7)+,D0-D5/A1
0000187E  4E75                    1199              RTS
00001880                          1200              
00001880= 53 43 4F 52 45 3A ...   1201  .TXTSCORE   DC.B    'SCORE: ',0
00001888= 4C 45 56 45 4C 3A ...   1202  .TXTLEVEL   DC.B    'LEVEL: ',0
00001890                          1203              DS.W    0
00001890                          1204  
00001890                          1205  -------------------- end include --------------------
00001890                          1206              INCLUDE "STATES.X68"            ; GAME STATES MANAGEMENT
00001890                          1207  ; =============================================================================
00001890                          1208  ; GAME STATE MANAGEMENT
00001890                          1209  ; =============================================================================
00001890                          1210  
00001890                          1211  ; -----------------------------------------------------------------------------
00001890                          1212  STAINIT
00001890                          1213  ; INITALIZES THE STATE MANAGER
00001890                          1214  ; INPUT    - NONE
00001890                          1215  ; OUTPUT   - NONE
00001890                          1216  ; MODIFIES - NONE
00001890                          1217  ; -----------------------------------------------------------------------------
00001890  33FC FFFF 00002C40      1218              MOVE.W  #STANONE,STACUR  
00001898  33FC 0000 00002C42      1219              MOVE.W  #STAINTR,STANEXT  
000018A0  4E75                    1220              RTS
000018A2                          1221  ; -----------------------------------------------------------------------------
000018A2                          1222  STAUPD
000018A2                          1223  ; PERFORMS STATE UPDATE AND INIT IF NECESSARY
000018A2                          1224  ; INPUT    - NONE
000018A2                          1225  ; OUTPUT   - NONE
000018A2                          1226  ; MODIFIES - NONE
000018A2                          1227  ; -----------------------------------------------------------------------------
000018A2  48E7 8080               1228              MOVEM.L D0/A0,-(A7)
000018A6  4280                    1229              CLR.L   D0
000018A8  3039 00002C42           1230              MOVE.W  STANEXT,D0
000018AE  B079 00002C40           1231              CMP.W   (STACUR),D0
000018B4  6700 0012               1232              BEQ     .DOUPD
000018B8  33C0 00002C40           1233              MOVE.W  D0,STACUR 
000018BE  E588                    1234              LSL.L   #2,D0
000018C0  2040                    1235              MOVE.L  D0,A0
000018C2  2068 18E0               1236              MOVE.L  .INITBL(A0),A0
000018C6  4E90                    1237              JSR     (A0)
000018C8  4280                    1238  .DOUPD      CLR.L   D0                      ; IN ANY CASE, DO UPDATE
000018CA  3039 00002C40           1239              MOVE.W  STACUR,D0
000018D0  E588                    1240              LSL.L   #2,D0
000018D2  2040                    1241              MOVE.L  D0,A0
000018D4  2068 18F4               1242              MOVE.L  .UPDTBL(A0),A0
000018D8  4E90                    1243              JSR     (A0)
000018DA  4CDF 0101               1244              MOVEM.L (A7)+,D0/A0
000018DE  4E75                    1245              RTS
000018E0= 00001A26 000019A2 ...   1246  .INITBL     DC.L    STAINTRI,STAPLAYI,STAEMPTY,STASAVEI,STASAVEI 
000018F4= 00001A54 000019CC ...   1247  .UPDTBL     DC.L    STAINTRU,STASPACEU,STAPLAYU,STAFINU,STAFINU
00001908                          1248  ; -----------------------------------------------------------------------------
00001908                          1249  STAPLOT
00001908                          1250  ; PERFORMS STATE PLOT
00001908                          1251  ; INPUT    - NONE
00001908                          1252  ; OUTPUT   - NONE
00001908                          1253  ; MODIFIES - NONE
00001908                          1254  ; -----------------------------------------------------------------------------
00001908  48E7 8080               1255              MOVEM.L D0/A0,-(A7)
0000190C  4280                    1256              CLR.L   D0
0000190E  3039 00002C42           1257              MOVE.W  STANEXT,D0
00001914  E588                    1258              LSL.L   #2,D0
00001916  2040                    1259              MOVE.L  D0,A0
00001918  2068 1924               1260              MOVE.L  .PLTTBL(A0),A0         
0000191C  4E90                    1261              JSR     (A0)
0000191E  4CDF 0101               1262              MOVEM.L (A7)+,D0/A0
00001922  4E75                    1263              RTS
00001924= 00001ABA 00001A04 ...   1264  .PLTTBL     DC.L    STAINTRP,STAPLAYP,STAPLAYP,STAGOVRP,STAWINP
00001938                          1265  ; -----------------------------------------------------------------------------
00001938                          1266  STAEMPTY
00001938                          1267  ; EMPTY SUBROUTINE FOR CASES WITH NOTHING TO DO
00001938                          1268  ; INPUT    - NONE
00001938                          1269  ; OUTPUT   - NONE
00001938                          1270  ; MODIFIES - NONE
00001938                          1271  ; NOTE     - JUST A PLACEHOLDER. NOTHING TO DO.
00001938                          1272  ; -----------------------------------------------------------------------------
00001938  4E75                    1273              RTS
0000193A                          1274  ; -----------------------------------------------------------------------------
0000193A                          1275  STASAVEI
0000193A                          1276  ; SAVES THE INFORMATION OF THE PLAYER
0000193A                          1277  ; INPUT    - NONE
0000193A                          1278  ; OUTPUT   - NONE
0000193A                          1279  ; MODIFIES - NONE
0000193A                          1280  ; NOTE     - JUST A PLACEHOLDER. NOTHING TO DO.
0000193A                          1281  ; -----------------------------------------------------------------------------
0000193A  48E7 C0E0               1282              MOVEM.L D0-D1/A0-A2,-(A7)
0000193E                          1283              
0000193E  43F9 00002C78           1284              LEA.L   RNKTABLE,A1
00001944  3239 00002C76           1285              MOVE.W  POSRNK,D1
0000194A  0C91 FFFFFFFF           1286              CMP.L   #$FFFFFFFF,(A1)         
00001950  6700 002E               1287              BEQ     .LOAD                   ; IF THE MATRIX IS EMPTY
00001954                          1288              
00001954                          1289              ; MOVES ALL THE ELEMENTS AT THE RIGHT 
00001954  2049                    1290              MOVE.L  A1,A0            
00001956  2449                    1291              MOVE.L  A1,A2
00001958  D4C1                    1292              ADDA.W  D1,A2
0000195A  94FC 000A               1293              SUBA.W   #10,A2
0000195E  D0C1                    1294              ADDA.W  D1,A0                   
00001960  82FC 000A               1295              DIVU    #10,D1
00001964  5341                    1296              SUBQ.W  #1,D1
00001966                          1297  .LOOP                   
00001966  303C 0009               1298              MOVE.W  #9,D0                   ; 10 COLUMNS
0000196A                          1299  .MOVER
0000196A  10DA                    1300              MOVE.B  (A2)+,(A0)+             ; A2 = OLD POS, A0 = NEW POS 
0000196C  51C8 FFFC               1301              DBRA    D0,.MOVER
00001970  95FC 00000014           1302              SUBA.L  #20,A2
00001976  91FC 00000014           1303              SUBA.L  #20,A0
0000197C  51C9 FFE8               1304              DBRA    D1,.LOOP
00001980                          1305  .LOAD                                       ; SAVES THE NAME AT ROW = 1
00001980  32B9 00002C4A           1306              MOVE.W  PSCORE,(A1)
00001986  5489                    1307              ADDA.L  #2,A1
00001988  303C 0007               1308              MOVE.W  #7,D0                   ; NAME = 8 BYTES
0000198C  41F9 00002C50           1309              LEA.L   PNAME,A0                 
00001992                          1310  .NAME
00001992  12D8                    1311              MOVE.B  (A0)+,(A1)+
00001994  51C8 FFFC               1312              DBRA    D0,.NAME          
00001998  4CDF 0703               1313              MOVEM.L (A7)+,D0-D1/A0-A2
0000199C                          1314          
0000199C                          1315  
0000199C  4EB8 16D8               1316              JSR     UTLWRFILE               ;ESCRIBIMOS EN EL FICHERO
000019A0  4E75                    1317              RTS
000019A2                          1318  ; -----------------------------------------------------------------------------
000019A2                          1319  STAPLAYI    ;DEL NIVEL1, COMIENZO
000019A2                          1320  
000019A2                          1321  ; PLAY STATE INITIALIZATION
000019A2                          1322  ; INPUT    - NONE
000019A2                          1323  ; OUTPUT   - NONE
000019A2                          1324  ; MODIFIES - NONE
000019A2                          1325  ; NOTE     - JUST A WRAPPER FOR PLRINIT
000019A2                          1326  ; -----------------------------------------------------------------------------
000019A2  48E7 FFFE               1327              MOVEM.L D0-D7/A0-A6,-(A7)
000019A6  33FC 00FB 00002C60      1328              MOVE.W  #BINPOSX,BPOSX1
000019AE  33FC 01CE 00002C66      1329              MOVE.W  #BINPOSY,BPOSY2
000019B6  33FC 0105 00002C62      1330              MOVE.W  #BINPOSX+BDIAMET,BPOSX2
000019BE  33FC 01C4 00002C64      1331              MOVE.W  #BINPOSY-BDIAMET,BPOSY1
000019C6                          1332              
000019C6  4CDF 7FFF               1333              MOVEM.L (A7)+,D0-D7/A0-A6
000019CA  4E75                    1334              RTS
000019CC                          1335  ; -----------------------------------------------------------------------------
000019CC                          1336  STASPACEU
000019CC                          1337  ; WAITS FOR SPACE TO BE PRESSED, AND BEGIN THE GAME
000019CC                          1338  ; INPUT    - NONE
000019CC                          1339  ; OUTPUT   - NONE
000019CC                          1340  ; MODIFIES - NONE
000019CC                          1341  ; -----------------------------------------------------------------------------
000019CC  33FC 00E0 00002C44      1342              MOVE.W  #PINPOSX1,PPOSX
000019D4  0839 0004 00001F87      1343              BTST.B  #KBDBITF1,(KBDEDGE)
000019DC  6700 000A               1344              BEQ     .END
000019E0  33FC 0002 00002C42      1345              MOVE.W  #STAPLAY,STANEXT
000019E8                          1346  .END        
000019E8  4E75                    1347              RTS
000019EA                          1348  ; -----------------------------------------------------------------------------
000019EA                          1349  STAPLAYU
000019EA                          1350  ; PLAY STATE UPDATE
000019EA                          1351  ; INPUT    - NONE
000019EA                          1352  ; OUTPUT   - NONE
000019EA                          1353  ; MODIFIES - NONE
000019EA                          1354  ; -----------------------------------------------------------------------------
000019EA  48E7 FFFE               1355              MOVEM.L D0-D7/A0-A6,-(A7)
000019EE  4EB8 1746               1356              JSR     PLRUPD
000019F2  4EB9 00001C46           1357              JSR     BUPD    
000019F8  4EB9 00001DF6           1358              JSR     BLUPD
000019FE  4CDF 7FFF               1359              MOVEM.L (A7)+,D0-D7/A0-A6          
00001A02  4E75                    1360              RTS
00001A04                          1361  ; -----------------------------------------------------------------------------
00001A04                          1362  STAPLAYP
00001A04                          1363  ; PLAY STATE PLOT
00001A04                          1364  ; INPUT    - NONE
00001A04                          1365  ; OUTPUT   - NONE
00001A04                          1366  ; MODIFIES - NONE
00001A04                          1367  ; -----------------------------------------------------------------------------
00001A04  48E7 FFFE               1368              MOVEM.L D0-D7/A0-A6,-(A7)
00001A08  4EB9 00001D12           1369              JSR     BPLOT
00001A0E  4EB9 00001ECA           1370              JSR     BLPLOT
00001A14  4EB8 1792               1371              JSR     PPLOT
00001A18  4EB8 1540               1372              JSR     UTLSREENP
00001A1C  4EB8 15DC               1373              JSR     UTLREADRNK
00001A20  4CDF 7FFF               1374              MOVEM.L (A7)+,D0-D7/A0-A6 
00001A24  4E75                    1375              RTS
00001A26                          1376  ; -----------------------------------------------------------------------------
00001A26                          1377  STAINTRI   
00001A26                          1378  ; PARA QUE EL SCORE LA VIDA SE VUELVAN A REINICIAR
00001A26                          1379  
00001A26                          1380  ; INTRO STATE INIT
00001A26                          1381  ; INPUT    - NONE
00001A26                          1382  ; OUTPUT   - NONE
00001A26                          1383  ; MODIFIES - NONE
00001A26                          1384  ; -----------------------------------------------------------------------------
00001A26  4EB8 111A               1385              JSR     DMMINIT
00001A2A  4EB8 1596               1386              JSR     UTLREADFILE
00001A2E  4EB8 1264               1387              JSR     UTLINTRI
00001A32                          1388m             UTLSIZC #INTPRSC,TXSSIZE
00001A32                          1389m ; WRAPPER FOR SET SIZE AND COLOR TRAP 15 TASK.
00001A32                          1390m ; INPUT    - #INTPRSC COLOR IN FORMAT $00BBGGRR TXSSIZE SIZE (8, 9, 10, 12, 14, 16, 18))
00001A32                          1391m ; OUTPUT   - NONE
00001A32                          1392m ; MODIFIES - D0,D1
00001A32                          1393m ; -----------------------------------------------------------------------------
00001A44                          1394m             UTLLOCT 18,25  
00001A44                          1395m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001A44                          1396m ; INPUT    - 18 X, 25 Y
00001A44                          1397m ; OUTPUT   - NONE
00001A44                          1398m ; MODIFIES - D0,D1
00001A44                          1399m ; -----------------------------------------------------------------------------
00001A4E  4EB8 1216               1400              JSR     UTLSVNAME
00001A52  4E75                    1401              RTS
00001A54                          1402  
00001A54                          1403  ; -----------------------------------------------------------------------------
00001A54                          1404  STAINTRU
00001A54                          1405  ; INTRO STATE UPDATE
00001A54                          1406  ; INPUT    - NONE
00001A54                          1407  ; OUTPUT   - NONE
00001A54                          1408  ; MODIFIES - NONE
00001A54                          1409  ; -----------------------------------------------------------------------------
00001A54                          1410m             UTLSNDS .SOUND,#1
00001A54                          1411m ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
00001A54                          1412m ; INPUT    - .SOUND ADDRESS TO STRING WITH NAME OF THE FILE, #1 NUM SOUNDS, 
00001A54                          1413m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001A54                          1414m ; MODIFIES - D0,A1
00001A54                          1415m ; -----------------------------------------------------------------------------
00001A6A  0839 0004 00001F87      1416              BTST.B  #KBDBITF1,(KBDEDGE)
00001A72  6700 0030               1417              BEQ     .END
00001A76  33FC 0001 00002C42      1418              MOVE.W  #STASPACE,STANEXT
00001A7E                          1419m             UTLSNDST
00001A7E                          1420m ; WRAPPER FOR STOPPING WAV FILE TRAP 15 TASK
00001A7E                          1421m ; INPUT    - NONE 
00001A7E                          1422m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001A7E                          1423m ; MODIFIES - D0,A1
00001A7E                          1424m ; -----------------------------------------------------------------------------
00001A86  4EB8 1710               1425              JSR     PLRINIT
00001A8A  4EB9 00001D52           1426              JSR     BLINIT
00001A90  4EB9 00001BB2           1427              JSR     BINIT
00001A96  33FC 0003 00002C48      1428              MOVE.W  #PINLIVE,PLIVES
00001A9E  4279 00002C4A           1429              CLR.W   PSCORE              
00001AA4                          1430  .END        
00001AA4  4E75                    1431              RTS
00001AA6= 73746172 74206C61 ...   1432  .SOUND      DC.L    'start largo.wav',0
00001ABA                          1433  
00001ABA                          1434             
00001ABA                          1435  ; -----------------------------------------------------------------------------
00001ABA                          1436  STAINTRP
00001ABA                          1437  ; INTRO STATE PLOT
00001ABA                          1438  ; INPUT    - NONE
00001ABA                          1439  ; OUTPUT   - NONE
00001ABA                          1440  ; MODIFIES - NONE
00001ABA                          1441  ; -----------------------------------------------------------------------------
00001ABA  4EB8 1264               1442             JSR      UTLINTRI
00001ABE  48E7 E040               1443              MOVEM.L D0-D2/A1,-(A7)
00001AC2                          1444              ;START
00001AC2                          1445m             UTLLOCT INTPRSX,INTPRSY
00001AC2                          1446m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001AC2                          1447m ; INPUT    - INTPRSX X, INTPRSY Y
00001AC2                          1448m ; OUTPUT   - NONE
00001AC2                          1449m ; MODIFIES - D0,D1
00001AC2                          1450m ; -----------------------------------------------------------------------------
00001ACC                          1451m             UTLSIZC #INTPRSC,TXSSIZE
00001ACC                          1452m ; WRAPPER FOR SET SIZE AND COLOR TRAP 15 TASK.
00001ACC                          1453m ; INPUT    - #INTPRSC COLOR IN FORMAT $00BBGGRR TXSSIZE SIZE (8, 9, 10, 12, 14, 16, 18))
00001ACC                          1454m ; OUTPUT   - NONE
00001ACC                          1455m ; MODIFIES - D0,D1
00001ACC                          1456m ; -----------------------------------------------------------------------------
00001ADE  43F9 00001AF0           1457              LEA     .PRSSTR,A1
00001AE4  103C 000E               1458              MOVE.B  #14,D0
00001AE8  4E4F                    1459              TRAP    #15
00001AEA  4CDF 0207               1460              MOVEM.L (A7)+,D0-D2/A1
00001AEE  4E75                    1461              RTS
00001AF0= 50 55 53 48 20 46 ...   1462  .PRSSTR     DC.B    'PUSH FIRE TO START',0
00001B04                          1463              DS.W    0
00001B04                          1464             
00001B04                          1465  ; -----------------------------------------------------------------------------
00001B04                          1466  STAFINU
00001B04                          1467  ; GAME OVER STATE UPDATE
00001B04                          1468  ; INPUT    - NONE
00001B04                          1469  ; OUTPUT   - NONE
00001B04                          1470  ; MODIFIES - NONE
00001B04                          1471  ; -----------------------------------------------------------------------------
00001B04                          1472              ;visualiza el fichero
00001B04  0839 0004 00001F87      1473              BTST.B  #KBDBITF1,(KBDEDGE)
00001B0C  6700 0012               1474              BEQ     .END
00001B10                          1475m             UTLSNDST
00001B10                          1476m ; WRAPPER FOR STOPPING WAV FILE TRAP 15 TASK
00001B10                          1477m ; INPUT    - NONE 
00001B10                          1478m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001B10                          1479m ; MODIFIES - D0,A1
00001B10                          1480m ; -----------------------------------------------------------------------------
00001B18  33FC 0000 00002C42      1481              MOVE.W  #STAINTR,(STANEXT)
00001B20  4E75                    1482  .END        RTS
00001B22                          1483  
00001B22                          1484  ; -----------------------------------------------------------------------------
00001B22                          1485  STAGOVRP
00001B22                          1486  ; GAME OVER STATE PLOT
00001B22                          1487  ; INPUT    - NONE
00001B22                          1488  ; OUTPUT   - NONE
00001B22                          1489  ; MODIFIES - NONE
00001B22                          1490  ; -----------------------------------------------------------------------------
00001B22  48E7 E040               1491              MOVEM.L A1/D0-D2,-(A7)
00001B26                          1492              ;GAME OVER TEXT
00001B26                          1493m             UTLLOCT GOVERX,GOVERY            
00001B26                          1494m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001B26                          1495m ; INPUT    - GOVERX X, GOVERY Y
00001B26                          1496m ; OUTPUT   - NONE
00001B26                          1497m ; MODIFIES - D0,D1
00001B26                          1498m ; -----------------------------------------------------------------------------
00001B30                          1499m             UTLSIZC #GOVERC,TXBSIZE
00001B30                          1500m ; WRAPPER FOR SET SIZE AND COLOR TRAP 15 TASK.
00001B30                          1501m ; INPUT    - #GOVERC COLOR IN FORMAT $00BBGGRR TXBSIZE SIZE (8, 9, 10, 12, 14, 16, 18))
00001B30                          1502m ; OUTPUT   - NONE
00001B30                          1503m ; MODIFIES - D0,D1
00001B30                          1504m ; -----------------------------------------------------------------------------
00001B42                          1505m             UTLSFIL #$00000000
00001B42                          1506m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001B42                          1507m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
00001B42                          1508m ; OUTPUT   - NONE
00001B42                          1509m ; MODIFIES - D0,D1
00001B42                          1510m ; -----------------------------------------------------------------------------
00001B4A  43F9 00001B5C           1511              LEA     .GOVSTR,A1              ;PONE EL TEXTO
00001B50  103C 000E               1512              MOVE.B  #14,D0
00001B54  4E4F                    1513              TRAP    #15
00001B56                          1514  
00001B56  4CDF 0207               1515              MOVEM.L (A7)+,A1/D0-D2
00001B5A  4E75                    1516              RTS
00001B5C= 47 41 4D 45 20 4F ...   1517  .GOVSTR     DC.B    'GAME OVER',0
00001B66                          1518              DS.W    0
00001B66                          1519              
00001B66                          1520  ; -----------------------------------------------------------------------------
00001B66                          1521  STAWINP
00001B66                          1522  ; WIN STATE PLOT
00001B66                          1523  ; INPUT    - NONE
00001B66                          1524  ; OUTPUT   - NONE
00001B66                          1525  ; MODIFIES - NONE
00001B66                          1526  ; -----------------------------------------------------------------------------
00001B66  48E7 E040               1527              MOVEM.L D0-D2/A1,-(A7)
00001B6A                          1528              ;TITULO
00001B6A                          1529m             UTLLOCT INTTITX-1,INTTITY      
00001B6A                          1530m ; WRAPPER TO TEXT POSITIONNING FROM TRAP 15
00001B6A                          1531m ; INPUT    - INTTITX-1 X, INTTITY Y
00001B6A                          1532m ; OUTPUT   - NONE
00001B6A                          1533m ; MODIFIES - D0,D1
00001B6A                          1534m ; -----------------------------------------------------------------------------
00001B74                          1535m             UTLSIZC #GREEN,TXBSIZE
00001B74                          1536m ; WRAPPER FOR SET SIZE AND COLOR TRAP 15 TASK.
00001B74                          1537m ; INPUT    - #GREEN COLOR IN FORMAT $00BBGGRR TXBSIZE SIZE (8, 9, 10, 12, 14, 16, 18))
00001B74                          1538m ; OUTPUT   - NONE
00001B74                          1539m ; MODIFIES - D0,D1
00001B74                          1540m ; -----------------------------------------------------------------------------
00001B86  43F9 00001B98           1541              LEA     .TITSTR,A1            
00001B8C  103C 000E               1542              MOVE.B  #14,D0
00001B90  4E4F                    1543              TRAP    #15
00001B92  4CDF 0207               1544              MOVEM.L (A7)+,D0-D2/A1
00001B96  4E75                    1545              RTS
00001B98= 43 4F 4E 47 52 41 ...   1546  .TITSTR     DC.B    'CONGRATULATIONS, YOU WON!',0
00001BB2                          1547              DS.W    0
00001BB2                          1548  
00001BB2                          1549  
00001BB2                          1550  
00001BB2                          1551  
00001BB2                          1552  
00001BB2                          1553  
00001BB2                          1554  
00001BB2                          1555  
00001BB2                          1556  
00001BB2                          1557  -------------------- end include --------------------
00001BB2                          1558              INCLUDE "BALL.X68"              ; BALL MANAGEMENT
00001BB2                          1559  ; =============================================================================
00001BB2                          1560  ; BALL
00001BB2                          1561  ; =============================================================================
00001BB2                          1562  
00001BB2                          1563  ; -----------------------------------------------------------------------------
00001BB2                          1564  BINIT
00001BB2                          1565  ;INITIALIZE THE BALL
00001BB2                          1566  ; INPUT    - NONE 
00001BB2                          1567  ; OUTPUT   - NONE 
00001BB2                          1568  ; MODIFIES - NONE
00001BB2                          1569  ; -----------------------------------------------------------------------------
00001BB2  33FC 00FB 00002C60      1570              MOVE.W  #BINPOSX,BPOSX1
00001BBA  33FC 01CE 00002C66      1571              MOVE.W  #BINPOSY,BPOSY2
00001BC2  33FC 0105 00002C62      1572              MOVE.W  #BINPOSX+BDIAMET,BPOSX2
00001BCA  33FC 01C4 00002C64      1573              MOVE.W  #BINPOSY-BDIAMET,BPOSY1
00001BD2  33FC FFFD 00002C58      1574              MOVE.W  #BINSPEED,BSPEEDX
00001BDA  33FC FFFD 00002C5A      1575              MOVE.W  #BINSPEED,BSPEEDY
00001BE2  4E75                    1576              RTS
00001BE4                          1577  ; -----------------------------------------------------------------------------
00001BE4                          1578  BNXTLEV
00001BE4                          1579  ;INITIALIZE THE BALL TO THE NEXT LEVEL
00001BE4                          1580  ; INPUT    - NONE 
00001BE4                          1581  ; OUTPUT   - NONE 
00001BE4                          1582  ; MODIFIES - NONE
00001BE4                          1583  ; -----------------------------------------------------------------------------
00001BE4  48E7 8000               1584              MOVEM.L D0,-(A7)
00001BE8  33FC 00FB 00002C60      1585              MOVE.W  #BINPOSX,BPOSX1
00001BF0  33FC 01CE 00002C64      1586              MOVE.W  #BINPOSY,BPOSY1
00001BF8  33FC 0105 00002C62      1587              MOVE.W  #BINPOSX+BDIAMET,BPOSX2
00001C00  33FC 01D8 00002C66      1588              MOVE.W  #BINPOSY+BDIAMET,BPOSY2
00001C08  3039 00002C5A           1589              MOVE.W  BSPEEDY,D0
00001C0E  6B00 000E               1590              BMI     .NEGY
00001C12  5279 00002C5A           1591              ADD.W   #1,BSPEEDY
00001C18  4EF9 00001C24           1592              JMP     .X
00001C1E                          1593  .NEGY        
00001C1E  5379 00002C5A           1594              SUB.W   #1,BSPEEDY
00001C24                          1595  .X          
00001C24  3039 00002C58           1596              MOVE.W  BSPEEDX,D0
00001C2A  6B00 000E               1597              BMI     .NEGX 
00001C2E  5279 00002C58           1598              ADD.W   #1,BSPEEDX
00001C34  4EF9 00001C40           1599              JMP     .END
00001C3A                          1600  .NEGX       
00001C3A  5379 00002C58           1601              SUB.W   #1,BSPEEDX 
00001C40                          1602  .END        
00001C40  4CDF 0001               1603              MOVEM.L (A7)+,D0
00001C44  4E75                    1604              RTS
00001C46                          1605        
00001C46                          1606  ;-----------------------------------------------------------------------------
00001C46                          1607  BUPD
00001C46                          1608  ; UPDATES THE BALL MOTION
00001C46                          1609  ; INPUT    - NONE 
00001C46                          1610  ; OUTPUT   - NONE 
00001C46                          1611  ; MODIFIES - NONE
00001C46                          1612  ; -----------------------------------------------------------------------------
00001C46  48E7 FFC0               1613              MOVEM.L D0-D7/A0-A1,-(A7)
00001C4A                          1614              ;COMPRUEBA COLISIONES CON LAS 4 PAREDES
00001C4A                          1615              ;Y SI PASA LA DE ABAJO LE ELIMINA UNA VIDA, O ENVIA LA PANTALLA GAME OVER
00001C4A  3039 00002C60           1616              MOVE.W  BPOSX1,D0
00001C50  3239 00002C64           1617              MOVE.W  BPOSY1,D1
00001C56  3439 00002C62           1618              MOVE.W  BPOSX2,D2
00001C5C  3639 00002C66           1619              MOVE.W  BPOSY2,D3
00001C62  4EB8 12A8               1620              JSR     UTLCHCOLW               ;COMPRUEBA COLISIÓN CON PAREDES               
00001C66  4EB8 13BA               1621              JSR     UTLCHCOLP               ;COMPRUEBA COLISIÓN CON PLATAFORMA
00001C6A  4284                    1622              CLR.L   D4
00001C6C  3A39 00002C62           1623              MOVE.W  BPOSX2,D5
00001C72  3C39 00002C66           1624              MOVE.W  BPOSY2,D6
00001C78  4EB8 1452               1625              JSR     UTLCOLBL
00001C7C                          1626              
00001C7C  B87C 0000               1627              CMP     #0,D4
00001C80  6600 0066               1628              BNE     .END
00001C84  3039 00002C62           1629              MOVE.W  BPOSX2,D0
00001C8A  3239 00002C64           1630              MOVE.W  BPOSY1,D1
00001C90  3A39 00002C60           1631              MOVE.W  BPOSX1,D5
00001C96  3C39 00002C66           1632              MOVE.W  BPOSY2,D6
00001C9C  4EB8 1452               1633              JSR     UTLCOLBL
00001CA0  B87C 0000               1634              CMP     #0,D4
00001CA4  6600 0042               1635              BNE     .END
00001CA8  3039 00002C60           1636              MOVE.W  BPOSX1,D0
00001CAE  3239 00002C66           1637              MOVE.W  BPOSY2,D1
00001CB4  3A39 00002C62           1638              MOVE.W  BPOSX2,D5
00001CBA  3C39 00002C64           1639              MOVE.W  BPOSY1,D6
00001CC0  4EB8 1452               1640              JSR     UTLCOLBL
00001CC4  B87C 0000               1641              CMP     #0,D4
00001CC8  6600 001E               1642              BNE     .END
00001CCC  3039 00002C62           1643              MOVE.W  BPOSX2,D0
00001CD2  3239 00002C66           1644              MOVE.W  BPOSY2,D1
00001CD8  3A39 00002C60           1645              MOVE.W  BPOSX1,D5
00001CDE  3C39 00002C64           1646              MOVE.W  BPOSY1,D6
00001CE4  4EB8 1452               1647              JSR     UTLCOLBL   
00001CE8                          1648  .END            
00001CE8  3039 00002C58           1649              MOVE.W  BSPEEDX,D0              ;POSICIÓN = POSICIÓN + VELOCIDAD
00001CEE  D179 00002C60           1650              ADD.W   D0,BPOSX1
00001CF4  D179 00002C62           1651              ADD.W   D0,BPOSX2
00001CFA                          1652              
00001CFA  3239 00002C5A           1653              MOVE.W  BSPEEDY,D1
00001D00  D379 00002C64           1654              ADD.W   D1,BPOSY1
00001D06  D379 00002C66           1655              ADD.W   D1,BPOSY2
00001D0C  4CDF 03FF               1656              MOVEM.L (A7)+,D0-D7/A0-A1
00001D10  4E75                    1657              RTS
00001D12                          1658  ;-----------------------------------------------------------------------------
00001D12                          1659  BPLOT
00001D12                          1660  ; PLOTES THE BALL 
00001D12                          1661  ; INPUT    - NONE 
00001D12                          1662  ; OUTPUT   - NONE 
00001D12                          1663  ; MODIFIES - NONE
00001D12                          1664  ; -----------------------------------------------------------------------------
00001D12  48E7 F800               1665              MOVEM.L  D0-D4,-(A7)
00001D16                          1666m             UTLSPEN #BINCOLOR
00001D16                          1667m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001D16                          1668m ; INPUT    - #BINCOLOR COLOR IN FORMAT $00BBGGRR
00001D16                          1669m ; OUTPUT   - NONE
00001D16                          1670m ; MODIFIES - D0,D1
00001D16                          1671m ; -----------------------------------------------------------------------------
00001D22                          1672m             UTLSFIL #BINCOLOR
00001D22                          1673m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001D22                          1674m ; INPUT    - #BINCOLOR COLOR IN FORMAT $00BBGGRR
00001D22                          1675m ; OUTPUT   - NONE
00001D22                          1676m ; MODIFIES - D0,D1
00001D22                          1677m ; -----------------------------------------------------------------------------
00001D2E  3239 00002C60           1678              MOVE.W  BPOSX1,D1
00001D34  3439 00002C64           1679              MOVE.W  BPOSY1,D2
00001D3A  3639 00002C62           1680              MOVE.W  BPOSX2,D3
00001D40  3839 00002C66           1681              MOVE.W  BPOSY2,D4
00001D46  103C 0058               1682              MOVE.B  #88,D0
00001D4A  4E4F                    1683              TRAP    #15
00001D4C  4CDF 001F               1684              MOVEM.L  (A7)+,D0-D4
00001D50  4E75                    1685              RTS
00001D52                          1686  
00001D52                          1687  
00001D52                          1688  -------------------- end include --------------------
00001D52                          1689              INCLUDE "BLOCKS.X68"            ; BLOQUES
00001D52                          1690  ;-----------------------------------------------------------
00001D52                          1691  ;           BLOCKS
00001D52                          1692  ;-----------------------------------------------------------
00001D52                          1693    
00001D52                          1694  BLINIT
00001D52  48E7 8080               1695              MOVEM.L D0/A0,-(A7)
00001D56  41F9 00002C6A           1696              LEA.L   BLMATRIX,A0
00001D5C  303C 000B               1697              MOVE.W #BLROW-1,D0             
00001D60                          1698  .LOOP                   
00001D60  10FC 00FF               1699              MOVE.B  #%11111111,(A0)+
00001D64  51C8 FFFA               1700              DBRA    D0,.LOOP
00001D68  4279 00002C68           1701              CLR.W   BLCOUNTER
00001D6E  4EB9 00001F28           1702              JSR     BLCOUNTBL
00001D74  33FC 0001 00002C4E      1703              MOVE.W  #1,LEVEL
00001D7C  4CDF 0101               1704              MOVEM.L (A7)+,D0/A0
00001D80  4E75                    1705              RTS
00001D82                          1706  BLLEV2           
00001D82  48E7 8080               1707              MOVEM.L D0/A0,-(A7)
00001D86  41F9 00002C6A           1708              LEA.L   BLMATRIX,A0
00001D8C  303C 000B               1709              MOVE.W  #BLROW-1,D0          
00001D90                          1710  .LOOP       
00001D90  10FC 005A               1711              MOVE.B  #%01011010,(A0)+
00001D94  51C8 FFFA               1712              DBRA    D0,.LOOP
00001D98  4279 00002C68           1713              CLR.W   BLCOUNTER
00001D9E  4EB9 00001F28           1714              JSR     BLCOUNTBL
00001DA4  4CDF 0101               1715              MOVEM.L (A7)+,D0/A0
00001DA8  4E75                    1716              RTS
00001DAA                          1717              
00001DAA                          1718  BLLEV3              
00001DAA  48E7 0080               1719              MOVEM.L A0,-(A7)
00001DAE  41F9 00002C6A           1720              LEA.L   BLMATRIX,A0         
00001DB4  10FC 00F5               1721              MOVE.B  #%11110101,(A0)+
00001DB8  10FC 00A5               1722              MOVE.B  #%10100101,(A0)+
00001DBC  10FC 00A5               1723              MOVE.B  #%10100101,(A0)+
00001DC0  10FC 00A5               1724              MOVE.B  #%10100101,(A0)+
00001DC4  10FC 00A5               1725              MOVE.B  #%10100101,(A0)+
00001DC8  10FC 00E5               1726              MOVE.B  #%11100101,(A0)+
00001DCC  10FC 00A5               1727              MOVE.B  #%10100101,(A0)+
00001DD0  10FC 00A5               1728              MOVE.B  #%10100101,(A0)+
00001DD4  10FC 00A5               1729              MOVE.B  #%10100101,(A0)+
00001DD8  10FC 00A5               1730              MOVE.B  #%10100101,(A0)+
00001DDC  10FC 00A5               1731              MOVE.B  #%10100101,(A0)+
00001DE0  10FC 00F5               1732              MOVE.B  #%11110101,(A0)+
00001DE4  4279 00002C68           1733              CLR.W   BLCOUNTER
00001DEA  4EB9 00001F28           1734              JSR     BLCOUNTBL
00001DF0  4CDF 0100               1735              MOVEM.L (A7)+,A0
00001DF4  4E75                    1736              RTS
00001DF6                          1737  
00001DF6                          1738  
00001DF6                          1739  ; -----------------------------------------------------------------------------
00001DF6                          1740  BLUPD
00001DF6                          1741  ; UPDATES THE LEVELS OF THE GAME
00001DF6                          1742  ; INPUT     - NONE
00001DF6                          1743  ; OUTPUT    - NONE
00001DF6                          1744  ; MODIFIES  - NONE
00001DF6                          1745  ; -----------------------------------------------------------------------------
00001DF6  48E7 C000               1746              MOVEM.L D0-D1,-(A7)
00001DFA  3039 00002C68           1747              MOVE.W  BLCOUNTER,D0
00001E00  B07C 0000               1748              CMP     #0,D0                   ;SI NO HAY BLOQUES SALTA
00001E04  6600 009E               1749              BNE     .END
00001E08                          1750  .NEXTLEVEL  
00001E08  5279 00002C4E           1751              ADD.W   #1,LEVEL
00001E0E                          1752m             UTLSNDST
00001E0E                          1753m ; WRAPPER FOR STOPPING WAV FILE TRAP 15 TASK
00001E0E                          1754m ; INPUT    - NONE 
00001E0E                          1755m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001E0E                          1756m ; MODIFIES - D0,A1
00001E0E                          1757m ; -----------------------------------------------------------------------------
00001E16                          1758m             UTLSNDS .SOUND,#1
00001E16                          1759m ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
00001E16                          1760m ; INPUT    - .SOUND ADDRESS TO STRING WITH NAME OF THE FILE, #1 NUM SOUNDS, 
00001E16                          1761m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001E16                          1762m ; MODIFIES - D0,A1
00001E16                          1763m ; -----------------------------------------------------------------------------
00001E2C  3239 00002C4E           1764              MOVE.W  LEVEL,D1
00001E32  B27C 0004               1765              CMP     #4,D1
00001E36  6700 0046               1766              BEQ     .WON
00001E3A  B27C 0003               1767              CMP     #3,D1              
00001E3E  6700 001C               1768              BEQ     .NIVEL3
00001E42  33FC 0001 00002C42      1769              MOVE.W  #STASPACE,(STANEXT)
00001E4A  4EB8 1D82               1770              JSR     BLLEV2
00001E4E  4EB8 1722               1771              JSR     PLRLEV2
00001E52  4EB8 1BE4               1772              JSR     BNXTLEV
00001E56  4EF9 00001EA4           1773              JMP     .END
00001E5C                          1774  .NIVEL3
00001E5C  B27C 0003               1775              CMP.W   #3,D1
00001E60  6600 001C               1776              BNE     .WON
00001E64  33FC 0001 00002C42      1777              MOVE.W  #STASPACE,STANEXT
00001E6C  4EB8 1DAA               1778              JSR     BLLEV3 
00001E70  4EB8 1734               1779              JSR     PLRLEV3
00001E74  4EB8 1BE4               1780              JSR     BNXTLEV
00001E78  4EF9 00001EA4           1781              JMP     .END
00001E7E                          1782  .WON        
00001E7E                          1783m             UTLSNDST
00001E7E                          1784m ; WRAPPER FOR STOPPING WAV FILE TRAP 15 TASK
00001E7E                          1785m ; INPUT    - NONE 
00001E7E                          1786m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001E7E                          1787m ; MODIFIES - D0,A1
00001E7E                          1788m ; -----------------------------------------------------------------------------
00001E86                          1789m             UTLSNDS .WINNER,#1
00001E86                          1790m ; WRAPPER FOR PLAYING WAV FILE TRAP 15 TASK
00001E86                          1791m ; INPUT    - .WINNER ADDRESS TO STRING WITH NAME OF THE FILE, #1 NUM SOUNDS, 
00001E86                          1792m ; OUTPUT   - D0.W=0 IF SOUND NOT PLAYED, NON ZERO IF PLAYED
00001E86                          1793m ; MODIFIES - D0,A1
00001E86                          1794m ; -----------------------------------------------------------------------------
00001E9C  33FC 0004 00002C42      1795              MOVE.W  #STAWIN,STANEXT 
00001EA4                          1796  .END 
00001EA4  4CDF 0003               1797              MOVEM.L (A7)+,D0-D1
00001EA8  4E75                    1798              RTS    
00001EAA= 6C657665 6C207570 ...   1799  .SOUND      DC.L    'level up.wav',0 
00001EBA= 67616E61 722E7761 ...   1800  .WINNER     DC.L    'ganar.wav',0     
00001ECA                          1801  ; -----------------------------------------------------------------------------
00001ECA                          1802  BLPLOT
00001ECA                          1803  ; PLOTS THE BLOCKS
00001ECA                          1804  ; INPUT    - NONE
00001ECA                          1805  ; OUTPUT   - NONE
00001ECA                          1806  ; MODIFIES - NONE
00001ECA                          1807  ; -----------------------------------------------------------------------------
00001ECA  48E7 FFC0               1808              MOVEM.L D0-D7/A0-A1,-(A7)
00001ECE                          1809m             UTLSPEN #$00000000
00001ECE                          1810m ; WRAPPER FOR SET PEN TRAP 15 TASK.
00001ECE                          1811m ; INPUT    - #$00000000 COLOR IN FORMAT $00BBGGRR
00001ECE                          1812m ; OUTPUT   - NONE
00001ECE                          1813m ; MODIFIES - D0,D1
00001ECE                          1814m ; -----------------------------------------------------------------------------
00001ED6  4242                    1815              CLR.W   D2                      ; Y ARRIBA
00001ED8  383C 0010               1816              MOVE.W  #BLHEIGHT,D4            ; Y ABAJO
00001EDC  41F8 11E6               1817              LEA     COLORS,A0
00001EE0                          1818              
00001EE0  3E3C 000B               1819              MOVE.W  #BLROW-1,D7  
00001EE4  227C 00000000           1820              MOVE.L  #0,A1  
00001EEA                          1821  .FILAS      
00001EEA                          1822m             UTLSFIL (A0)+ 
00001EEA                          1823m ; WRAPPER FOR SET FIL TRAP 15 TASK.
00001EEA                          1824m ; INPUT    - (A0)+ COLOR IN FORMAT $00BBGGRR
00001EEA                          1825m ; OUTPUT   - NONE
00001EEA                          1826m ; MODIFIES - D0,D1
00001EEA                          1827m ; -----------------------------------------------------------------------------
00001EF2  363C 0040               1828              MOVE.W  #BLWIDTH,D3             ; X DERECHA
00001EF6  4241                    1829              CLR.W   D1                      ; X IZQUIERDA
00001EF8  3A3C 0007               1830              MOVE.W  #BLCOL-1,D5
00001EFC  1C29 2C6A               1831              MOVE.B  BLMATRIX(A1),D6
00001F00                          1832  .COLUM                                    
00001F00  E31E                    1833              ROL.B   #1,D6
00001F02  6400 0008               1834              BCC     .VACIO                  
00001F06  103C 0057               1835              MOVE.B  #87,D0                  ; DIBUJAMOS EL CUADRADO
00001F0A  4E4F                    1836              TRAP    #15
00001F0C                          1837  .VACIO
00001F0C  3203                    1838              MOVE.W  D3,D1
00001F0E  0643 0040               1839              ADD.W   #BLWIDTH, D3
00001F12  51CD FFEC               1840              DBRA    D5,.COLUM
00001F16  5249                    1841              ADDA.W  #1,A1
00001F18  3404                    1842              MOVE.W  D4,D2
00001F1A  0644 0010               1843              ADD.W   #BLHEIGHT,D4
00001F1E  51CF FFCA               1844              DBRA    D7,.FILAS
00001F22  4CDF 03FF               1845              MOVEM.L (A7)+,D0-D7/A0-A1
00001F26  4E75                    1846              RTS
00001F28                          1847  ; -----------------------------------------------------------------------------
00001F28                          1848  BLCOUNTBL
00001F28                          1849  ; COUNTS THE NUMBER OF BLOCKS OF THE MATRIX
00001F28                          1850  ; INPUT    - NONE (BLMATRIX)
00001F28                          1851  ; OUTPUT   - NONE
00001F28                          1852  ; MODIFIES - NONE
00001F28                          1853  ; -----------------------------------------------------------------------------
00001F28  48E7 FF20               1854              MOVEM.L D0-D7/A2,-(A7)
00001F2C  323C 000B               1855              MOVE.W  #BLROW-1,D1    
00001F30  4283                    1856              CLR.L   D3
00001F32  227C 00000000           1857              MOVE.L  #0,A1                   ; RECORRE LAS FILAS (8 BYTES)
00001F38                          1858  .FILAS                                          
00001F38  343C 0007               1859              MOVE.W  #BLCOL-1,D2               
00001F3C  1029 2C6A               1860              MOVE.B  BLMATRIX(A1),D0
00001F40                          1861  .COLUM                       
00001F40  E318                    1862              ROL.B   #1,D0         
00001F42  6400 0004               1863              BCC     .VACIO
00001F46  5243                    1864              ADD.W   #1,D3
00001F48                          1865  .VACIO
00001F48  51CA FFF6               1866              DBRA    D2,.COLUM   
00001F4C  5289                    1867              ADDA.L  #1,A1
00001F4E  51C9 FFE8               1868              DBRA    D1,.FILAS
00001F52  33C3 00002C68           1869              MOVE.W  D3,BLCOUNTER
00001F58  4CDF 04FF               1870              MOVEM.L (A7)+,D0-D7/A2
00001F5C  4E75                    1871              RTS
00001F5E                          1872  
00001F5E                          1873  
00001F5E                          1874  
00001F5E                          1875  
00001F5E                          1876  
00001F5E                          1877  -------------------- end include --------------------
00001F5E                          1878  
00001F5E                          1879  ; --- INITIALIZE --------------------------------------------------------------
00001F5E                          1880              
00001F5E  4EB8 1000               1881  START       JSR     SYSINIT
00001F62                          1882              ; TO DO: CALL GAME INITIALIZATION CODE HERE
00001F62  4EB8 1890               1883              JSR     STAINIT                           
00001F66                          1884              
00001F66                          1885  ; --- UPDATE ------------------------------------------------------------------
00001F66                          1886              
00001F66  4E40                    1887  .LOOP       TRAP    #KBDTRAP                ; READ KEYBOARD                 
00001F68                          1888                                              ; UPDATE DEPENDING ON THE STATE
00001F68                          1889              ; TO DO: CALL GAME UPDATE CODE HERE
00001F68  4EB8 18A2               1890              JSR     STAUPD
00001F6C                          1891  
00001F6C                          1892  ; --- WAIT SYNCH --------------------------------------------------------------
00001F6C                          1893  
00001F6C  4A39 00001F88           1894  .WINT       TST.B   (SCRINTCT)              ; WAIT FOR INTERRUPT
00001F72  67F8                    1895              BEQ     .WINT
00001F74                          1896              
00001F74  4239 00001F88           1897              CLR.B   (SCRINTCT)
00001F7A                          1898  
00001F7A                          1899  ; --- PLOT --------------------------------------------------------------------
00001F7A                          1900              
00001F7A                          1901              ; TO DO: CALL GAME PLOT CODE HERE
00001F7A  4EB8 1908               1902              JSR     STAPLOT
00001F7E                          1903  
00001F7E  4E41                    1904              TRAP    #SCRTRAP                ; SHOW GRAPHICS
00001F80  60E4                    1905              BRA     .LOOP
00001F82  FFFF FFFF               1906              SIMHALT
00001F86                          1907  
00001F86                          1908  ; --- VARIABLES ---------------------------------------------------------------
00001F86                          1909  
00001F86                          1910              INCLUDE "SYSVAR.X68"
00001F86                          1911  ; =============================================================================
00001F86                          1912  ; SYSTEM VARS
00001F86                          1913  ; NOTE THAT ALL THESE VARS ARE USED TO SHARE DATA FROM SYSTEM TO USER. THUS
00001F86                          1914  ; THEY MUST NOT BE IN PROTECTED MEMORY.
00001F86                          1915  ; NOTE THAT USING DMMDATA IN SUCH WAY IS A BAD IDEA, AS USER APPLICATIONS CAN
00001F86                          1916  ; ALSO FREE OR CHANGE OWNERSHIP. NONETHELESS, FOR THE SAKE OF THIS EXAMPLE
00001F86                          1917  ; THIS IS GOOD ENOUGH.
00001F86                          1918  ; =============================================================================
00001F86                          1919  
00001F86                          1920  ; --- KEYBOARD RELATED VARIABLES ----------------------------------------------
00001F86                          1921  
00001F86                          1922  KBDVAL      DS.B    1                       ; KEY PRESSED=1
00001F87                          1923  KBDEDGE     DS.B    1                       ; KEY CHANGED=1
00001F88                          1924  
00001F88                          1925              DS.W    0
00001F88                          1926  
00001F88                          1927  ; --- SCREEN RELATED VARIABLES ------------------------------------------------
00001F88                          1928  
00001F88                          1929  SCRINTCT    DS.B    1                       ; INTERRUPT COUNTER/FLAG
00001F89                          1930  SCRCYCCT    DS.B    1                       ; CYCLE COUNTER
00001F8A                          1931              DS.W    0
00001F8A                          1932  
00001F8A                          1933  ; --- DYNAMIC MEMORY VARIABLES ------------------------------------------------
00001F8A                          1934  
00001FC0                          1935              ORG     (*+DMMBSIZE-1)&-DMMBSIZE ; ALIGN TO DMMBSIZE
00001FC0                          1936  DMMDATA     DS.B    DMMBSIZE*DMMBNUM        ; DYNAMIC MEMORY ALLOCATION SPACE
00002C40                          1937              DS.W    0                       ; JUST IN CASE (SIZE IS POW OF TWO)
00002C40                          1938  
00002C40                          1939  
00002C40                          1940  
00002C40                          1941  -------------------- end include --------------------
00002C40                          1942              INCLUDE "VAR.X68"
00002C40                          1943  ; =============================================================================
00002C40                          1944  ; GAME VARS
00002C40                          1945  ; =============================================================================
00002C40                          1946  
00002C40                          1947  ; --- GAME STATE RELATED VARIABLES --------------------------------------------
00002C40                          1948  
00002C40                          1949  STACUR      DS.W    1                       ; CURRENT GAME STATE
00002C42                          1950  STANEXT     DS.W    1                       ; NEXT GAME STATE
00002C44                          1951  ;----------------------------------------------------------------------------
00002C44                          1952  
00002C44                          1953  ; -- PLAYER -------------------------------------------------------------------
00002C44                          1954  PPOSX       DS.W    1                       ;POSICION DE LA PLATAFORMA
00002C46                          1955  PWIDTH      DS.W    1                       ; PLAYER WIDTH (PIXELS)
00002C48                          1956  PLIVES      DS.W    1                       ;LIVES LEFT
00002C4A                          1957  PSCORE      DS.W    1                       ;SCORE DEL PLAYER
00002C4C                          1958  PSPEED      DS.W    1
00002C4E                          1959  LEVEL       DS.B    2
00002C50                          1960  PNAME       DS.B    8                      ; NAME
00002C58                          1961  ;----------------------------------------------------------------------------
00002C58                          1962  
00002C58                          1963  ; BALL ----------------------------------------------------------------------
00002C58                          1964  ;BPOSX       DS.W    1                       ;POSICION DE LA PELOTA X
00002C58                          1965  ;BPOSY       DS.W    1                       ;POSICION DE LA PELOTA Y
00002C58                          1966  BSPEEDX     DS.W    1                       ;VELOCIDAD DE LA PELOTA
00002C5A                          1967  BSPEEDY     DS.W    1
00002C5C                          1968  BMXSPEED    DS.W    1                       ;LIMITACIÓN
00002C5E                          1969  BCOLOR      DS.W    1
00002C60                          1970  BPOSX1      DS.W    1
00002C62                          1971  BPOSX2      DS.W    1
00002C64                          1972  BPOSY1      DS.W    1
00002C66                          1973  BPOSY2      DS.W    1
00002C68                          1974  ; --- BLOCKS ------------------------------------------------------------------
00002C68                          1975  BLCOUNTER   DS.W    1
00002C6A                          1976  BLMATRIX    DS.B    BLROW  ;12*8
00002C76                          1977              DS.W    0
00002C76                          1978  
00002C76                          1979  ; --- RANKING TABLE -----------------------------------------------------------
00002C76                          1980  POSRNK      DS.W    1                       ; NUMBER OF BYTES READ 
00002C78                          1981  RNKTABLE    DS.B    10                      ; RANKING TABLE
00002C82                          1982  
00002C82                          1983  
00002C82                          1984  
00002C82                          1985  -------------------- end include --------------------
00002C82                          1986              END    START

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
BCOLOR              2C5E
BDIAMET             A
BINCOLOR            FFFFFF
BINIT               1BB2
BINPOSX             FB
BINPOSY             1CE
BINSPEED            FFFFFFFD
BLCOL               8
BLCOUNTBL           1F28
BLCOUNTBL:COLUM     1F40
BLCOUNTBL:FILAS     1F38
BLCOUNTBL:VACIO     1F48
BLCOUNTER           2C68
BLHEIGHT            10
BLINIT              1D52
BLINIT:LOOP         1D60
BLLEV2              1D82
BLLEV2:LOOP         1D90
BLLEV3              1DAA
BLMATRIX            2C6A
BLPLOT              1ECA
BLPLOT:COLUM        1F00
BLPLOT:FILAS        1EEA
BLPLOT:VACIO        1F0C
BLROW               C
BLUE                F7E78E
BLUPD               1DF6
BLUPD:END           1EA4
BLUPD:NEXTLEVEL     1E08
BLUPD:NIVEL3        1E5C
BLUPD:SOUND         1EAA
BLUPD:WINNER        1EBA
BLUPD:WON           1E7E
BLWIDTH             40
BMXSPEED            2C5C
BNXTLEV             1BE4
BNXTLEV:END         1C40
BNXTLEV:NEGX        1C3A
BNXTLEV:NEGY        1C1E
BNXTLEV:X           1C24
BPLOT               1D12
BPOSX1              2C60
BPOSX2              2C62
BPOSY1              2C64
BPOSY2              2C66
BSPEEDX             2C58
BSPEEDY             2C5A
BUPD                1C46
BUPD:END            1CE8
COLORS              11E6
DMMALLOC            11AC
DMMALLOC:END        11C4
DMMBNUM             32
DMMBSIZE            40
DMMDATA             1FC0
DMMFCOM             1186
DMMFFND             1194
DMMFIRST            113C
DMMFLOOP            117A
DMMFRCOM            114E
DMMFREE             11C6
DMMFRFND            115C
DMMFRLOP            1142
DMMFRSTO            1174
DMMINIT             111A
DMMINIT:LOOP        1128
DMMNEXT             115E
DMMNEXTO            1196
DMMSYSID            0
FILE                11DC
GOVERC              FFFF
GOVERX              12
GOVERY              7
GREEN               95FF8C
INTPRSC             FFFFFF
INTPRSX             20
INTPRSY             52
INTTITC             DCAA7C
INTTITX             E
INTTITY             7
KBDBITDN            3
KBDBITF1            4
KBDBITF2            5
KBDBITF3            6
KBDBITLF            0
KBDBITPS            7
KBDBITRT            2
KBDBITUP            1
KBDCHRDN            28
KBDCHRLF            25
KBDCHRMK            4D
KBDCHRPK            50
KBDCHRRT            27
KBDCHRSH            10
KBDCHRSP            20
KBDCHRUP            26
KBDDOWN             28
KBDEDGE             1F87
KBDFIRE1            20
KBDFIRE2            4D
KBDFIRE3            10
KBDINIT             10A6
KBDLEFT             25
KBDMSKDN            8
KBDMSKF1            10
KBDMSKF2            20
KBDMSKF3            40
KBDMSKLF            1
KBDMSKPS            80
KBDMSKRT            4
KBDMSKUP            2
KBDPAUSE            50
KBDREAD             10BC
KBDREAD:LOOP1       10D2
KBDREAD:LOOP2       10EE
KBDRIGHT            27
KBDTRAP             0
KBDUP               26
KBDVAL              1F86
LEVEL               2C4E
LIVECOLOR           6666FF
LIVEHEIGHT          10
LIVEPOSX            215
LIVEPOSY            1E
LIVEWIDTH           40
ORANGE              4E8CF3
PCOLOR              ECD59D
PHEIGHT             C
PINLIVE             3
PINPOSX1            E0
PINPOSX2            E5
PINPOSX3            EA
PINWIDTH1           40
PINWIDTH2           36
PINWIDTH3           2C
PLIVES              2C48
PLRINIT             1710
PLRLEV2             1722
PLRLEV3             1734
PLRUPD              1746
PLRUPD:END          178C
PLRUPD:RIGHTKEY     176A
PMOVE               8
PNAME               2C50
POSRNK              2C76
PPLOT               1792
PPLOT:END           187A
PPLOT:LIFES         1808
PPLOT:TXTLEVEL      1888
PPLOT:TXTSCORE      1880
PPOSX               2C44
PPOSY               1D0
PSCORE              2C4A
PSCORECOL           FFFFFF
PSCORETX            3E
PSCORETY            6
PSPEED              2C4C
PURPLE              FFACAC
PWIDTH              2C46
RNKPNAC             46
RNKPOSR             11
RNKPSCC             3C
RNKTABLE            2C78
SCRCTRL             201
SCRCYCCT            1F89
SCRHEIGH            1E0
SCRINIT             101C
SCRINTCT            1F88
SCRIRQ              1
SCRISR              107E
SCRLWIDTH           5
SCRRNKY             C8
SCRTIM              14
SCRTRAP             1
SCRUPD              108C
SCRWIDTH            2E4
STACUR              2C40
STAEMPTY            1938
STAFINU             1B04
STAFINU:END         1B20
STAGOVR             3
STAGOVRP            1B22
STAGOVRP:GOVSTR     1B5C
STAINIT             1890
STAINTR             0
STAINTRI            1A26
STAINTRP            1ABA
STAINTRP:PRSSTR     1AF0
STAINTRU            1A54
STAINTRU:END        1AA4
STAINTRU:SOUND      1AA6
STANEXT             2C42
STANONE             FFFFFFFF
STAPLAY             2
STAPLAYI            19A2
STAPLAYP            1A04
STAPLAYU            19EA
STAPLOT             1908
STAPLOT:PLTTBL      1924
START               1F5E
START:LOOP          1F66
START:WINT          1F6C
STASAVEI            193A
STASAVEI:LOAD       1980
STASAVEI:LOOP       1966
STASAVEI:MOVER      196A
STASAVEI:NAME       1992
STASPACE            1
STASPACEU           19CC
STASPACEU:END       19E8
STAUPD              18A2
STAUPD:DOUPD        18C8
STAUPD:INITBL       18E0
STAUPD:UPDTBL       18F4
STAWIN              4
STAWINP             1B66
STAWINP:TITSTR      1B98
SYSINIT             1000
TXBSIZE             12
TXMSIZE             10
TXSSIZE             A
UTLCHCOLP           13BA
UTLCHCOLP:END       144C
UTLCHCOLP:LADOS     1446
UTLCHCOLP:PLRXMIDDLE  1400
UTLCHCOLP:PLRXRIGHT  142E
UTLCHCOLW           12A8
UTLCHCOLW:COLLIS    138A
UTLCHCOLW:DOWN      1314
UTLCHCOLW:END       1384
UTLCHCOLW:LEFT      12D2
UTLCHCOLW:MINLIVE   1320
UTLCHCOLW:RESET     137C
UTLCHCOLW:RIGHT     12F2
UTLCHCOLW:SOUNDG    1392
UTLCHCOLW:SOUNDL    13A6
UTLCOLBL            1452
UTLCOLBL:CHOQUEDOBLE  1496
UTLCOLBL:CHOQUEDOBLEIZQ  14C4
UTLCOLBL:DERECHA    14E2
UTLCOLBL:ENDCOLISION  14EE
UTLCOLBL:ENDNOCOLISION  152E
UTLCOLBL:ENMEDIO    14D0
UTLCOLBL:IZQ        147C
UTLCOLBL:SOUND      1530
UTLCOLBL:TEST       1476
UTLCOLBL:TEST2      14AC
UTLINTRI            1264
UTLINTRI:TITSTR     1296
UTLLOCT             254
UTLREADFILE         1596
UTLREADFILE:HAYALGO  15CA
UTLREADRNK          15DC
UTLREADRNK:END      165C
UTLREADRNK:LOOP     1628
UTLREADRNK:TEXT     1662
UTLSFIL             12A
UTLSIZC             37C
UTLSNDS             4F7
UTLSNDST            6E5
UTLSPEN             0
UTLSREENP           1540
UTLSREENP:TXTSCORE  158C
UTLSVNAME           1216
UTLSVNAME:INSTRUCT  123E
UTLWRFILE           16D8
UTLWRRNK            1674
UTLWRRNK:LOAD       16BA
UTLWRRNK:LOOP       16A0
UTLWRRNK:MOVER      16A4
UTLWRRNK:NAME       16CC
YELLOW              38EEF8
